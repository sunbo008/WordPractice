# level-certification Specification

## Purpose
TBD - created by archiving change add-level-certification-system. Update Purpose after archive.
## Requirements
### Requirement: 考级系列结构

系统 SHALL 提供四大考级系列：音标系列、小学年级系列、课外阅读系列、升学系列，采用树状解锁机制。

#### Scenario: 音标系列结构

- **GIVEN** 用户进入考级系统
- **THEN** 音标系列 SHALL 包含5个小级别：
  - 短元音（Short Vowels）：/æ/, /e/, /ɪ/, /ɒ/, /ʌ/
  - 长元音（Long Vowels）：/iː/, /uː/, /ɑː/, /ɔː/, /ɜː/
  - 双元音（Diphthongs）：/eɪ/, /aɪ/, /ɔɪ/, /əʊ/, /aʊ/, /ɪə/, /eə/, /ʊə/
  - 辅音（Consonants）：/p/, /b/, /t/, /d/, /k/, /g/ 等
  - 复合音（Complex Sounds）：/tʃ/, /dʒ/, /ʃ/, /ʒ/, /θ/, /ð/ 等
- **AND** 音标系列始终解锁可用
- **AND** 完成音标系列全部5个小级别后获得音标徽章

#### Scenario: 小学年级系列结构

- **GIVEN** 用户已获得音标徽章
- **THEN** 小学年级系列 SHALL 解锁，包含4个大级别：
  - 3年级：上学期 + 下学期（2个小级别）
  - 4年级：上学期 + 下学期（2个小级别）
  - 5年级：上学期 + 下学期（2个小级别）
  - 6年级：上学期 + 下学期（2个小级别）
- **AND** 每个年级大级别的上下学期都通过后获得该年级徽章

#### Scenario: 6年级后双分支解锁

- **GIVEN** 用户已获得6年级徽章
- **THEN** 系统 SHALL 同时解锁两个分支：
  - 课外阅读系列
  - 升学系列
- **AND** 两个分支独立进行，互不影响

#### Scenario: 课外阅读系列结构

- **GIVEN** 用户已获得6年级徽章
- **THEN** 课外阅读系列 SHALL 包含4个大级别：
  - Fly Guy（苍蝇小子）：小级别待定
  - Magic Tree House（神奇树屋）：小级别待定
  - Dragon Ball（七龙珠）：小级别待定
  - Harry Potter（哈利波特）：小级别待定
- **AND** 必须按顺序逐级通过
- **AND** 每个大级别通过后获得对应徽章

#### Scenario: 升学系列结构

- **GIVEN** 用户已获得6年级徽章
- **THEN** 升学系列 SHALL 包含3个大级别：
  - 初中（Middle School）：6个小级别（7/8/9年级各上下学期）
  - 高中（High School）：6个小级别（高一/高二/高三各上下学期）
  - 四级（CET-4）：3个小级别（核心词汇、高频词汇、进阶词汇）
- **AND** 必须按顺序逐级通过
- **AND** 每个大级别的所有小级别通过后获得对应徽章

### Requirement: 考级通过标准

系统 SHALL 使用正确率作为考级通过标准，通过阈值为 90%，考试不限时。

#### Scenario: 考试通过

- **GIVEN** 用户正在进行某级别考试
- **WHEN** 考试结束时正确率 ≥ 90%
- **THEN** 系统 SHALL 标记该级别为已通过
- **AND** 记录最高分数
- **AND** 解锁下一个级别

#### Scenario: 考试未通过

- **GIVEN** 用户正在进行某级别考试
- **WHEN** 考试结束时正确率 < 90%
- **THEN** 系统 SHALL 显示未通过提示
- **AND** 显示本次得分和差距
- **AND** 该级别进入30分钟冷却期

#### Scenario: 重复考试刷新分数

- **GIVEN** 用户已通过某级别
- **WHEN** 用户重新考试该级别
- **AND** 获得更高分数
- **THEN** 系统 SHALL 更新该级别的最高分数

#### Scenario: 考试无时间限制

- **GIVEN** 用户开始某级别考试
- **THEN** 系统 SHALL 不设置考试时间限制
- **AND** 用户可以按自己的节奏完成考试

### Requirement: 失败冷却机制

系统 SHALL 在考试未通过后对该级别设置30分钟冷却期。

#### Scenario: 进入冷却期

- **GIVEN** 用户某级别考试未通过（正确率 < 90%）
- **THEN** 该级别 SHALL 进入30分钟冷却期
- **AND** 显示剩余冷却时间

#### Scenario: 冷却期间尝试重考

- **GIVEN** 某级别处于冷却期内
- **WHEN** 用户尝试开始该级别考试
- **THEN** 系统 SHALL 阻止考试开始
- **AND** 显示"请等待 XX 分钟后重试"

#### Scenario: 冷却期结束

- **GIVEN** 某级别冷却期已过30分钟
- **THEN** 该级别 SHALL 恢复可考试状态
- **AND** 用户可以重新开始考试

#### Scenario: 已通过级别无冷却

- **GIVEN** 用户已通过某级别
- **WHEN** 用户想重考该级别
- **THEN** 系统 SHALL 允许立即开始考试
- **AND** 无需等待冷却期

### Requirement: 树状解锁机制

系统 SHALL 强制用户按照树状结构逐级通过考试，支持6年级后的双分支并行解锁。

#### Scenario: 音标系列逐级解锁

- **GIVEN** 用户在音标系列
- **WHEN** 用户通过"短元音"级别
- **THEN** "长元音"级别 SHALL 解锁
- **AND** 后续级别保持锁定

#### Scenario: 小学年级系列解锁

- **GIVEN** 用户获得音标徽章
- **THEN** 3年级上学期 SHALL 解锁
- **AND** 其他年级保持锁定

#### Scenario: 年级内逐级解锁

- **GIVEN** 用户通过"3年级上学期"
- **THEN** "3年级下学期" SHALL 解锁
- **WHEN** 用户通过"3年级下学期"
- **THEN** "4年级上学期" SHALL 解锁
- **AND** 用户获得3年级徽章

#### Scenario: 双分支并行解锁

- **GIVEN** 用户获得6年级徽章
- **THEN** 课外阅读系列的第一个大级别（Fly Guy）SHALL 解锁
- **AND** 升学系列的第一个大级别（初中）SHALL 解锁
- **AND** 两个分支可以独立进行

### Requirement: 徽章系统

系统 SHALL 为每个大级别提供徽章奖励，采用欧洲古老家族徽章风格设计，共12枚徽章。

#### Scenario: 徽章获得条件

- **GIVEN** 用户在某个大级别
- **WHEN** 用户通过该大级别的所有小级别
- **THEN** 系统 SHALL 授予该大级别徽章
- **AND** 显示徽章获得动画
- **AND** 徽章在考级页面悬挂区显示

#### Scenario: 徽章视觉状态

- **GIVEN** 考级页面显示徽章
- **WHEN** 徽章未获得
- **THEN** 徽章 SHALL 显示为灰色（未点亮）
- **WHEN** 徽章已获得
- **THEN** 徽章 SHALL 显示为彩色（点亮）

#### Scenario: 徽章设计风格

- **GIVEN** 系统需要显示徽章
- **THEN** 徽章 SHALL 采用欧洲古老家族徽章风格：
  - 盾形主体、丝带/橄榄枝装饰、金属浮雕质感
  - 音标徽章：深蓝 + 金色
  - 3年级徽章：森林绿 + 金色
  - 4年级徽章：皇家蓝 + 银色
  - 5年级徽章：深紫 + 金色
  - 6年级徽章：绯红 + 金色
  - Fly Guy徽章：天蓝色 + 银色
  - 神奇树屋徽章：森林绿 + 棕色
  - 七龙珠徽章：橙色 + 金色
  - 哈利波特徽章：深红 + 金色
  - 初中徽章：学院蓝 + 银色
  - 高中徽章：学院紫 + 金色
  - 四级徽章：大学红 + 金色

### Requirement: 主页徽章区

系统 SHALL 在主页左上角提供徽章展示区域，作为考级系统入口。

#### Scenario: 无徽章状态

- **GIVEN** 用户尚未获得任何徽章
- **WHEN** 用户查看主页
- **THEN** 徽章区 SHALL 显示挑衅手势图标
- **AND** 显示挑战性文字
- **AND** 点击可进入考级页面

#### Scenario: 有徽章状态

- **GIVEN** 用户已获得至少一枚徽章
- **WHEN** 用户查看主页
- **THEN** 徽章区 SHALL 显示已获得的徽章缩略图
- **AND** 点击可进入考级页面

#### Scenario: 点击进入考级页面

- **GIVEN** 用户在主页
- **WHEN** 用户点击徽章区
- **THEN** 系统 SHALL 导航到考级页面

### Requirement: 考级页面布局

系统 SHALL 提供专门的考级页面，采用游戏升级加点风格的 UI 设计，支持树状技能树展示。

#### Scenario: 徽章悬挂区

- **GIVEN** 用户进入考级页面
- **THEN** 页面顶部 SHALL 显示徽章悬挂区
- **AND** 分区显示：基础徽章（音标+小学）、阅读徽章、升学徽章
- **AND** 已获得徽章显示彩色，未获得显示灰色

#### Scenario: 技能树布局

- **GIVEN** 用户进入考级页面
- **THEN** 页面 SHALL 显示树状技能树：
  - 主干：音标 → 3年级 → 4年级 → 5年级 → 6年级
  - 分支1：6年级 → Fly Guy → 神奇树屋 → 七龙珠 → 哈利波特
  - 分支2：6年级 → 初中 → 高中 → 四级
- **AND** 节点之间用连接线表示解锁关系
- **AND** 分叉处清晰标识双分支

#### Scenario: 级别节点状态显示

- **GIVEN** 考级页面显示级别节点
- **WHEN** 级别已通过
- **THEN** 节点 SHALL 显示绿色勾选标记和分数
- **WHEN** 级别已解锁但未通过
- **THEN** 节点 SHALL 显示可点击状态
- **WHEN** 级别锁定
- **THEN** 节点 SHALL 显示锁定图标和灰色样式

### Requirement: 考级进度持久化

系统 SHALL 将考级进度保存到本地存储，确保刷新页面后进度不丢失。

#### Scenario: 保存进度

- **GIVEN** 用户完成一次考试
- **THEN** 系统 SHALL 自动保存以下信息到 localStorage：
  - 每个级别的通过状态
  - 每个级别的最高分数
  - 每个级别的尝试次数
  - 每个徽章的获得状态和时间

#### Scenario: 恢复进度

- **GIVEN** 用户刷新页面或重新访问
- **WHEN** 进入考级系统
- **THEN** 系统 SHALL 从 localStorage 恢复所有考级进度
- **AND** 正确显示解锁状态和分数

### Requirement: 小级别分数显示

系统 SHALL 使用分数而非徽章来表示小级别的完成状态。

#### Scenario: 未考试级别

- **GIVEN** 某小级别从未参加考试
- **THEN** 该级别 SHALL 显示"待考"或"--"

#### Scenario: 已考试级别

- **GIVEN** 某小级别已参加考试
- **THEN** 该级别 SHALL 显示最高分数（如：92%）
- **AND** 通过的级别（≥90%）显示绿色分数
- **AND** 未通过的级别（<90%）显示红色分数

### Requirement: 测试模式支持
系统 SHALL 支持通过 URL 参数 `test=2` 开启测试模式，在荣誉殿堂中显示所有徽章为已获得状态。

#### Scenario: 测试模式开启所有徽章
- **WHEN** 用户访问带有 `?test=2` 参数的荣誉殿堂页面
- **THEN** 所有徽章显示为彩色已获得状态
- **AND** 所有徽章显示亮星标记

### Requirement: 徽章通过标志
系统 SHALL 在已获得的徽章右下角显示🏅通过标志。

#### Scenario: 已获得徽章显示通过标志
- **WHEN** 用户查看荣誉殿堂中已获得的徽章
- **THEN** 徽章右下角显示🏅图标
- **AND** 图标紧挨徽章边缘

### Requirement: 徽章鼓励语句
系统 SHALL 为每个徽章配置专属鼓励语句，在鼠标悬停时显示。

#### Scenario: 鼠标悬停显示鼓励语句
- **WHEN** 用户将鼠标悬停在已获得的徽章上
- **THEN** tooltip 中显示该徽章的鼓励语句
- **AND** tooltip 还显示解锁日期

### Requirement: 动态单词计数
系统 SHALL 动态计算考试单词数量（去重后），而非使用静态配置值。

#### Scenario: 考试确认弹窗显示动态单词数
- **WHEN** 用户点击考试按钮打开确认弹窗
- **THEN** 弹窗先显示 "计算中..."
- **AND** 然后显示实际去重后的单词数量

### Requirement: 徽章区位置
徽章区 SHALL 显示在游戏页面 header 的最左边，与标题同行。

#### Scenario: 徽章区与标题同行显示
- **WHEN** 用户进入游戏主页面
- **THEN** 徽章区显示在 header 左侧
- **AND** 标题居中显示

