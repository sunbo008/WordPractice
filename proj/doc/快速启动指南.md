# Web æœåŠ¡å¿«é€Ÿå¯åŠ¨æŒ‡å—

> ä¸€é”®å¯åŠ¨ã€åœæ­¢å’Œç®¡ç† monkeysoft.cn Web æœåŠ¡

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šä½¿ç”¨ç®¡ç†è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /root/workspace/WordPractice/proj

# å¯åŠ¨æ‰€æœ‰æœåŠ¡
./manage.sh start

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
./manage.sh status

# åœæ­¢æ‰€æœ‰æœåŠ¡
./manage.sh stop

# é‡å¯æ‰€æœ‰æœåŠ¡
./manage.sh restart

# æŸ¥çœ‹æ—¥å¿—
./manage.sh logs
```

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨å¯åŠ¨

```bash
# 1. å¯åŠ¨ Node.js æœåŠ¡å™¨ï¼ˆç«¯å£ 3000ï¼‰
cd /root/workspace/WordPractice/proj
nohup node dev-server.js > /tmp/dev-server.log 2>&1 &
echo $! > /tmp/dev-server.pid

# 2. å¯åŠ¨ Caddyï¼ˆHTTPSï¼Œç«¯å£ 80/443ï¼‰
systemctl start caddy

# 3. éªŒè¯æœåŠ¡
curl -I https://monkeysoft.cn/
```

---

## ğŸ“‹ å¸¸ç”¨å‘½ä»¤

### å¯åŠ¨æœåŠ¡

```bash
# æ–¹å¼ 1: ä½¿ç”¨ç®¡ç†è„šæœ¬
./manage.sh start

# æ–¹å¼ 2: æ‰‹åŠ¨å¯åŠ¨
nohup node dev-server.js > /tmp/dev-server.log 2>&1 &
systemctl start caddy
```

### åœæ­¢æœåŠ¡

```bash
# æ–¹å¼ 1: ä½¿ç”¨ç®¡ç†è„šæœ¬ï¼ˆæ¨èï¼‰
./manage.sh stop

# æ–¹å¼ 2: å¿«é€Ÿåœæ­¢
pkill -f "node dev-server.js"
systemctl stop caddy

# æ–¹å¼ 3: ä¼˜é›…åœæ­¢
systemctl stop caddy    # å…ˆåœæ­¢ Caddy
sleep 2                 # ç­‰å¾…ç°æœ‰è¯·æ±‚
kill $(cat /tmp/dev-server.pid)  # åœæ­¢ Node.js
rm /tmp/dev-server.pid
```

### é‡å¯æœåŠ¡

```bash
# å®Œæ•´é‡å¯
./manage.sh restart

# ä»…é‡å¯ Node.jsï¼ˆä»£ç æ›´æ”¹åï¼‰
pkill -f "node dev-server.js"
cd /root/workspace/WordPractice/proj
nohup node dev-server.js > /tmp/dev-server.log 2>&1 &

# ä»…é‡å¯ Caddyï¼ˆé…ç½®æ›´æ”¹åï¼‰
systemctl restart caddy
# æˆ–é‡è½½é…ç½®ï¼ˆä¸ä¸­æ–­æœåŠ¡ï¼‰
systemctl reload caddy
```

### æŸ¥çœ‹çŠ¶æ€

```bash
# ä½¿ç”¨ç®¡ç†è„šæœ¬ï¼ˆè¯¦ç»†çŠ¶æ€ï¼‰
./manage.sh status

# æ‰‹åŠ¨æŸ¥çœ‹
systemctl status caddy
ps aux | grep "node dev-server"
lsof -i :443  # HTTPS
lsof -i :80   # HTTP
lsof -i :3000 # Node.js
```

### æŸ¥çœ‹æ—¥å¿—

```bash
# ä½¿ç”¨ç®¡ç†è„šæœ¬
./manage.sh logs

# å®æ—¶æŸ¥çœ‹ Caddy æ—¥å¿—
journalctl -u caddy -f

# å®æ—¶æŸ¥çœ‹ Node.js æ—¥å¿—
tail -f /tmp/dev-server.log

# æŸ¥çœ‹æœ€è¿‘çš„é”™è¯¯
journalctl -u caddy -n 50 --no-pager
```

---

## ğŸ” æ•…éšœæ’æŸ¥

### æœåŠ¡æ— æ³•å¯åŠ¨

```bash
# 1. æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :80
lsof -i :443
lsof -i :3000

# 2. æŸ¥çœ‹é”™è¯¯æ—¥å¿—
journalctl -u caddy -n 50
tail -50 /tmp/dev-server.log

# 3. éªŒè¯é…ç½®
caddy validate --config /etc/caddy/Caddyfile
node /root/workspace/WordPractice/proj/dev-server.js  # å‰å°è¿è¡Œæµ‹è¯•
```

### HTTPS æ— æ³•è®¿é—®

```bash
# 1. æ£€æŸ¥ Caddy çŠ¶æ€
systemctl status caddy

# 2. æ£€æŸ¥è¯ä¹¦
caddy list-certificates

# 3. æµ‹è¯•æœ¬åœ°è®¿é—®
curl -I http://localhost:3000/  # Node.js
curl -I https://localhost/      # Caddy

# 4. æµ‹è¯•è¿œç¨‹è®¿é—®
curl -I https://monkeysoft.cn/
```

### Node.js æœåŠ¡å™¨æ— å“åº”

```bash
# 1. æ£€æŸ¥è¿›ç¨‹
ps aux | grep "node dev-server"

# 2. æ£€æŸ¥æ—¥å¿—
tail -50 /tmp/dev-server.log

# 3. é‡å¯æœåŠ¡
pkill -f "node dev-server.js"
cd /root/workspace/WordPractice/proj
node dev-server.js  # å‰å°è¿è¡Œï¼ŒæŸ¥çœ‹é”™è¯¯
```

---

## ğŸ“Š æœåŠ¡æ¶æ„

```
äº’è”ç½‘
   â†“
Caddy (443/80)
   â”‚
   â”œâ”€ SSL ç»ˆæ­¢
   â”œâ”€ HTTP â†’ HTTPS é‡å®šå‘
   â””â”€ åå‘ä»£ç†
       â†“
Node.js (3000)
   â”‚
   â”œâ”€ é™æ€æ–‡ä»¶æœåŠ¡
   â”œâ”€ _headers é…ç½®
   â””â”€ TTS API ä»£ç†
       â†“
   é¡¹ç›®æ–‡ä»¶
```

---

## ğŸ¯ è®¿é—®åœ°å€

- **HTTPSï¼ˆæ¨èï¼‰**: https://monkeysoft.cn/
- **HTTPï¼ˆè‡ªåŠ¨é‡å®šå‘ï¼‰**: http://monkeysoft.cn/
- **æœ¬åœ°æµ‹è¯•**: http://localhost:3000/

---

## ğŸ“ é‡è¦æ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `/root/workspace/WordPractice/proj/manage.sh` | æœåŠ¡ç®¡ç†è„šæœ¬ |
| `/root/workspace/WordPractice/proj/dev-server.js` | Node.js æœåŠ¡å™¨ |
| `/root/workspace/WordPractice/proj/_headers` | å“åº”å¤´é…ç½® |
| `/etc/caddy/Caddyfile` | Caddy é…ç½® |
| `/tmp/dev-server.log` | Node.js æ—¥å¿— |
| `/tmp/dev-server.pid` | Node.js è¿›ç¨‹ ID |

---

## âš™ï¸ é…ç½®ä¿®æ”¹

### ä¿®æ”¹ Node.js ä»£ç 

```bash
# 1. ç¼–è¾‘æ–‡ä»¶
vim /root/workspace/WordPractice/proj/dev-server.js

# 2. é‡å¯ Node.js
./manage.sh restart
# æˆ–
pkill -f "node dev-server.js"
cd /root/workspace/WordPractice/proj
nohup node dev-server.js > /tmp/dev-server.log 2>&1 &
```

### ä¿®æ”¹ _headers é…ç½®

```bash
# 1. ç¼–è¾‘æ–‡ä»¶
vim /root/workspace/WordPractice/proj/_headers

# 2. æ— éœ€é‡å¯ï¼ä¸‹æ¬¡è¯·æ±‚æ—¶è‡ªåŠ¨åŠ è½½
```

### ä¿®æ”¹ Caddy é…ç½®

```bash
# 1. ç¼–è¾‘é…ç½®
vim /etc/caddy/Caddyfile

# 2. éªŒè¯é…ç½®
caddy validate --config /etc/caddy/Caddyfile

# 3. é‡è½½é…ç½®ï¼ˆä¸ä¸­æ–­æœåŠ¡ï¼‰
systemctl reload caddy
```

---

## ğŸ” å¼€æœºè‡ªå¯åŠ¨

### æŸ¥çœ‹è‡ªå¯åŠ¨çŠ¶æ€

```bash
systemctl is-enabled caddy
```

### å¯ç”¨å¼€æœºè‡ªå¯åŠ¨

```bash
# Caddy å·²è‡ªåŠ¨å¯ç”¨
systemctl enable caddy

# Node.js éœ€è¦åˆ›å»º systemd æœåŠ¡
# å‚è€ƒå®Œæ•´æ–‡æ¡£ä¸­çš„è¯´æ˜
```

---

## ğŸ“ è·å–å¸®åŠ©

```bash
# æŸ¥çœ‹ç®¡ç†è„šæœ¬å¸®åŠ©
./manage.sh help

# æŸ¥çœ‹å®Œæ•´æ–‡æ¡£
cat /root/workspace/WordPractice/proj/doc/æœåŠ¡å™¨é…ç½®å®Œæ•´è®°å½•.md

# æŸ¥çœ‹æ—¥å¿—
./manage.sh logs
journalctl -u caddy -f
tail -f /tmp/dev-server.log
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

1. **æ—¥å¸¸ä½¿ç”¨**: ä½¿ç”¨ `manage.sh` è„šæœ¬ç®¡ç†æœåŠ¡
2. **ä»£ç æ›´æ”¹**: ä»…é‡å¯ Node.jsï¼Œæ— éœ€é‡å¯ Caddy
3. **é…ç½®æ›´æ”¹**: ä½¿ç”¨ `systemctl reload caddy` è€Œé `restart`
4. **_headers æ›´æ”¹**: æ— éœ€ä»»ä½•é‡å¯æ“ä½œ
5. **å®šæœŸæ£€æŸ¥**: ä½¿ç”¨ `./manage.sh status` æŸ¥çœ‹æœåŠ¡å¥åº·çŠ¶æ€
6. **æŸ¥çœ‹æ—¥å¿—**: å‡ºç°é—®é¢˜æ—¶å…ˆæŸ¥çœ‹æ—¥å¿—

---

## âš¡ ä¸€é”®å‘½ä»¤é€ŸæŸ¥

```bash
# å¯åŠ¨
./manage.sh start

# åœæ­¢
./manage.sh stop

# é‡å¯
./manage.sh restart

# çŠ¶æ€
./manage.sh status

# æ—¥å¿—
./manage.sh logs

# å¿«é€Ÿæ£€æŸ¥
systemctl status caddy && ps aux | grep "node dev-server"

# è®¿é—®æµ‹è¯•
curl -I https://monkeysoft.cn/
```

---

**æœ€åæ›´æ–°**: 2025å¹´10æœˆ23æ—¥  
**æ›´å¤šä¿¡æ¯**: æŸ¥çœ‹å®Œæ•´æ–‡æ¡£ `æœåŠ¡å™¨é…ç½®å®Œæ•´è®°å½•.md`

