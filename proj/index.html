<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Cannon - WORDå¤§ç‚®</title>
    <link rel="stylesheet" href="css/themes.css?v=20251130">
    <link rel="stylesheet" href="css/styles.css?v=20251130">
    <link rel="stylesheet" href="css/badge.css?v=20251127">
    <script>
        // ä¸»é¢˜åŠ è½½å™¨ - é¡µé¢åŠ è½½å‰åº”ç”¨ä¸»é¢˜ï¼Œé¿å…é—ªçƒ
        (function() {
            var theme = localStorage.getItem('wordTetris_selectedTheme') || 'default';
            if (theme !== 'default') {
                document.documentElement.className = 'theme-' + theme;
            }
        })();
    </script>
</head>
<body>
    <script>
        // ç«‹å³åº”ç”¨ä¸»é¢˜åˆ° body
        (function() {
            var theme = localStorage.getItem('wordTetris_selectedTheme') || 'default';
            document.body.className = 'theme-' + theme;
        })();
    </script>
    <div class="game-container">
        <!-- æ¸¸æˆæ ‡é¢˜ -->
        <header class="game-header">
            <h1>Word Cannon</h1>
            <p>WORDå¤§ç‚® - åœ¨æ¸¸æˆä¸­å­¦ä¹ è‹±è¯­</p>
        </header>

        <!-- æ¸¸æˆä¿¡æ¯æ  -->
        <div class="game-info">
            <div class="info-item">
                <span class="label">åˆ†æ•°:</span>
                <span id="score">0</span>
            </div>
            <div class="info-item">
                <span class="label">ç­‰çº§:</span>
                <span id="level">1</span>
            </div>
            <div class="info-item">
                <span class="label">ç›®æ ‡:</span>
                <span id="target">100</span>
            </div>
            <div class="info-item">
                <span class="label">å•è¯æ€»æ•°:</span>
                <span id="vocabulary-count">0</span>
            </div>
            <div class="info-item">
                <span class="label">æ—¶é—´:</span>
                <span id="time">00:00</span>
            </div>
            <div class="info-item">
                <span class="label">è¿å‡»:</span>
                <span id="combo">0</span>
            </div>
        </div>
        
        <!-- è€ƒè¯•ç»Ÿè®¡æ  -->
        <div class="exam-stats">
            <div class="stats-item">
                <span class="label">å‰©ä½™å¾…æµ‹:</span>
                <span id="total-words">0</span>
            </div>
            <div class="stats-item">
                <span class="label">æ­£ç¡®å‘½ä¸­:</span>
                <span id="hit-words">0</span>
                <span class="percentage">(<span id="hit-percentage">0%</span>)</span>
            </div>
            <div class="stats-item">
                <span class="label">è¦†ç›–ç‡:</span>
                <span id="coverage-percentage">0%</span>
            </div>
        </div>

        <!-- å·¦ä¾§é¢æ¿ï¼šå›¾ç‰‡å±•ç¤ºåŒº + æ§åˆ¶åŒº -->
        <aside class="left-panel">
            <section class="image-showcase">
                <div class="picture">
                    <img id="wordImage" alt="å•è¯å›¾ç‰‡" src="" />
                </div>
            </section>

            <!-- æ¸¸æˆæ§åˆ¶ -->
            <div class="game-controls">
                <div class="input-section">
                    <label for="letterInput">è¾“å…¥ç¼ºå¤±å­—æ¯:</label>
                    <input type="text" id="letterInput" placeholder="ç›´æ¥æŒ‰é”®ç›˜è¾“å…¥">
                    <div id="realTimePreview" class="real-time-preview">å®æ—¶é¢„è§ˆ: SRort</div>
                    <button id="giveUpBtn" class="give-up-btn">æ”¾å¼ƒ (ESCé”®)</button>
                    <div class="keyboard-hint">ğŸ’¡ ç›´æ¥æŒ‰é”®ç›˜å­—æ¯é”®è¾“å…¥ï¼ŒEnteræäº¤ï¼ŒBackspaceåˆ é™¤ï¼ŒESCæ”¾å¼ƒ</div>
                </div>
                
                <div class="control-buttons">
                    <button id="startBtn">å¼€å§‹æ¸¸æˆ</button>
                    <button id="pauseBtn" disabled>æš‚åœ</button>
                    <button id="resetBtn">é‡ç½®</button>
                    <button id="settingsBtn" class="settings-btn">âš™ï¸ è¯åº“è®¾ç½®</button>
                    <button id="toggleSpeechBtn" class="toggle-speech">ğŸ”Š è¯­éŸ³å¼€</button>
                    <button id="testBtn" class="test-btn">ğŸ§ª å•æµ‹</button>
                </div>
            </div>
        </aside>

        <!-- æ¸¸æˆä¸»ä½“ï¼šä»…ç”»å¸ƒ -->
        <div class="game-main">
            <!-- æ¸¸æˆç”»å¸ƒ -->
            <canvas id="gameCanvas" width="600" height="500"></canvas>
        </div>

        <!-- ä¾§è¾¹æ  -->
        <div class="sidebar">
            <!-- ç¼“å†²åŒºæŒ‡ç¤ºå™¨ -->
            <div class="buffer-indicator">
                <h3>å•è¯å‡†å¤‡åŒº</h3>
                <div class="traffic-lights">
                    <div class="light red" id="redLight"></div>
                    <div class="light yellow" id="yellowLight"></div>
                    <div class="light green" id="greenLight"></div>
                </div>
                <div id="nextWord">å‡†å¤‡ä¸­...</div>
            </div>

            <!-- é”™è¯æœ¬ -->
            <div class="vocabulary-book">
                <h3>é”™è¯æœ¬ (<span id="vocab-total-count">0</span>)</h3>
                <div id="vocabularyList">
                    <p>æš‚æ— é”™è¯</p>
                </div>
                <button id="exportBtn" disabled>å¯¼å‡ºé”™è¯</button>
            </div>

            <!-- å¾®ä¿¡å…¬ä¼—å· & æ¸¸æˆè¯´æ˜ -->
            <div class="game-instructions">
                <div class="instructions-content">
                    <img src="doc/å¾®ä¿¡å…¬ä¼—å·.png" alt="å¾®ä¿¡å…¬ä¼—å·" class="qrcode-img">
                    <div class="game-intro">
                        <h4>ğŸ® æ¸¸æˆç©æ³•</h4>
                        <ul>
                            <li>å•è¯ä»ä¸Šæ–¹ä¸‹é™</li>
                            <li>è¾“å…¥ç¼ºå¤±å­—æ¯å‡»è½</li>
                            <li>æœªå‡»è½ä¼šå †å </li>
                            <li>å †æ»¡æ—¶æ¸¸æˆç»“æŸ</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- è°ƒè¯•æ—¥å¿—é¢æ¿ -->
            <div id="debugPanel" class="debug-panel hidden">
                <div class="debug-header">
                    <h3>ğŸ“‹ è°ƒè¯•æ—¥å¿—</h3>
                    <div class="debug-controls">
                        <button id="toggleDebugBtn" class="debug-btn" title="æ˜¾ç¤º/éšè—æ—¥å¿—">
                            <span class="btn-icon">ğŸ‘ï¸</span>
                            <span class="btn-text">æ˜¾ç¤º</span>
                        </button>
                        <button id="copyDebugBtn" class="debug-btn" title="å¤åˆ¶å…¨éƒ¨æ—¥å¿—åˆ°å‰ªè´´æ¿">
                            <span class="btn-icon">ğŸ“‹</span>
                            <span class="btn-text">å¤åˆ¶</span>
                        </button>
                        <button id="clearDebugBtn" class="debug-btn" title="æ¸…ç©ºæ—¥å¿—">
                            <span class="btn-icon">ğŸ—‘ï¸</span>
                            <span class="btn-text">æ¸…ç©º</span>
                        </button>
                        <button id="exportDebugBtn" class="debug-btn" title="å¯¼å‡ºæ—¥å¿—åˆ°æ–‡ä»¶">
                            <span class="btn-icon">ğŸ’¾</span>
                            <span class="btn-text">å¯¼å‡º</span>
                        </button>
                    </div>
                </div>
                <div id="debugConsole" class="debug-console"></div>
            </div>
        </div>
    </div>

    <!-- æ¸¸æˆç»“æŸå¼¹çª— -->
    <div id="gameOverModal" class="modal">
        <div class="modal-content">
            <span class="close-btn">Ã—</span>
            <div class="modal-body">
                <h2>æ¸¸æˆç»“æŸ</h2>
                <p>æœ€ç»ˆåˆ†æ•°: <span id="finalScore">0</span></p>
                <p>è¾¾åˆ°ç­‰çº§: <span id="finalLevel">1</span></p>
                <p>æ”¶é›†é”™è¯: <span id="finalVocabulary">0</span> ä¸ª</p>
                <div class="modal-buttons">
                    <button id="restartBtn">é‡æ–°å¼€å§‹</button>
                    <button id="reviewVocabBtn">æŸ¥çœ‹é”™è¯æœ¬</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ç­‰çº§æå‡å¼¹çª— -->
    <div id="levelUpModal" class="modal">
        <div class="modal-content">
            <span class="close-btn">Ã—</span>
            <div class="modal-body">
                <h2>ğŸ‰ ç­‰çº§æå‡ï¼</h2>
                <p>æ­å–œå‡åˆ°ç¬¬ <span id="newLevel">2</span> çº§ï¼</p>
                <p>æœ¬çº§æ”¶é›†é”™è¯: <span id="levelVocabulary">0</span> ä¸ª</p>
                <div class="modal-buttons">
                    <button id="continueBtn">ç»§ç»­æ¸¸æˆ</button>
                    <button id="viewVocabBtn">æŸ¥çœ‹é”™è¯</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¸€æ¬¡æ€§æ¸…ç†æ—§é…ç½®ï¼ˆä»…åœ¨2025-10-06ä¹‹å‰çš„æ—§ç‰ˆæœ¬è¿è¡Œè¿‡ï¼‰ -->
    <script>
        // æ£€æŸ¥å¹¶æ¸…ç†æ—§çš„é…ç½®ç¼“å­˜ï¼ˆåªæ¸…ç†ä¸€æ¬¡ï¼‰
        (function() {
            const cleanupFlag = localStorage.getItem('wordTetris_configCleanedV3');
            if (!cleanupFlag) {
                // ç¬¬ä¸€æ¬¡è¿è¡Œæ–°ç‰ˆæœ¬ï¼Œæ£€æŸ¥æ˜¯å¦éœ€è¦æ¸…ç†
                const savedLibraries = localStorage.getItem('wordTetris_selectedLibraries');
                if (savedLibraries) {
                    try {
                        const libs = JSON.parse(savedLibraries);
                        
                        // æ£€æŸ¥æ˜¯å¦æ˜¯ç©ºæ•°ç»„æˆ–æ—§çš„4å¤©é…ç½®
                        const isEmpty = Array.isArray(libs) && libs.length === 0;
                        const isOldDefaultConfig = 
                            libs.length === 4 && 
                            libs.includes('day01') && 
                            libs.includes('day02') && 
                            libs.includes('day03') && 
                            libs.includes('day04');
                        
                        if (isEmpty) {
                            console.log('ğŸ”„ æ£€æµ‹åˆ°ç©ºé…ç½®ï¼Œæ­£åœ¨æ¸…ç†...');
                            localStorage.removeItem('wordTetris_selectedLibraries');
                            console.log('âœ… ç©ºé…ç½®å·²æ¸…ç†ï¼Œå°†ä½¿ç”¨é»˜è®¤é…ç½®ï¼ˆåŒ…å«æ‰€æœ‰å¯ç”¨è¯¾ç¨‹ï¼‰');
                        } else if (isOldDefaultConfig) {
                            console.log('ğŸ”„ æ£€æµ‹åˆ°æ—§ç‰ˆæœ¬é»˜è®¤é…ç½®ï¼ˆday01-04ï¼‰ï¼Œæ­£åœ¨æ¸…ç†...');
                            localStorage.removeItem('wordTetris_selectedLibraries');
                            console.log('âœ… æ—§é…ç½®å·²æ¸…ç†ï¼Œå°†ä½¿ç”¨æ–°çš„é»˜è®¤é…ç½®ï¼ˆåŒ…å«æ‰€æœ‰å¯ç”¨è¯¾ç¨‹ï¼‰');
                        } else {
                            console.log('âœ… ç”¨æˆ·è‡ªå®šä¹‰é…ç½®ä¿ç•™:', libs);
                        }
                    } catch (e) {
                        console.error('é…ç½®æ£€æŸ¥å¤±è´¥:', e);
                        // å¦‚æœè§£æå¤±è´¥ï¼Œæ¸…é™¤é…ç½®
                        localStorage.removeItem('wordTetris_selectedLibraries');
                    }
                }
                // æ ‡è®°å·²æ¸…ç†ï¼Œä¸‹æ¬¡ä¸å†æ‰§è¡Œ
                localStorage.setItem('wordTetris_configCleanedV3', 'true');
            }
        })();
    </script>
    
    <!-- è„šæœ¬åŠ è½½é”™è¯¯å¤„ç† -->
    <script>
        window.addEventListener('error', function(e) {
            if (e.filename) {
                console.error('âŒ è„šæœ¬åŠ è½½å¤±è´¥:', e.filename, e.message);
            }
        }, true);
    </script>
    
    <!-- å¼•å…¥è°ƒè¯•æ—¥å¿—ç³»ç»Ÿ -->
    <script src="src/utils/DebugLogger-standalone.js?v=20251107"></script>
    
    <!-- å¼•å…¥è€ƒçº§ç³»ç»Ÿ -->
    <script src="src/utils/CertificationStorage.js?v=20251201"></script>
    <script src="src/systems/CertificationSystem.js?v=20251201"></script>
    <script src="src/ui/BadgeArea.js?v=20251201"></script>
    <script src="src/ui/TierDisplay.js?v=20251201"></script>
    <script src="src/systems/ExamIntegration.js?v=20251130"></script>
    
    <!-- å¼•å…¥ R2 é…ç½®ï¼ˆå¿…é¡»åœ¨ AudioCacheManager å’Œ WordTetrisGame ä¹‹å‰ï¼‰ -->
    <script src="src/config/r2-config.js"></script>
    
    <!-- å¼•å…¥éŸ³é¢‘ç¼“å­˜ç®¡ç†å™¨ -->
    <script src="src/utils/AudioCacheManager.js?v=20251008" onerror="console.error('âŒ AudioCacheManager.js åŠ è½½å¤±è´¥')"></script>
    
    <!-- å¼•å…¥ TTS æœåŠ¡ -->
    <script src="src/utils/TTSService.js?v=20251008" onerror="console.error('âŒ TTSService.js åŠ è½½å¤±è´¥')"></script>
    <script>
        // æ£€æŸ¥ TTSService æ˜¯å¦æˆåŠŸåŠ è½½
        setTimeout(function() {
            if (typeof TTSService === 'undefined' && typeof window.TTSService === 'undefined') {
                console.error('âŒ TTSService æœªå®šä¹‰ï¼æ–‡ä»¶å¯èƒ½æœ‰è¯­æ³•é”™è¯¯æˆ–æœªæ­£ç¡®å¯¼å‡º');
                console.error('   è¯·æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯');
            } else {
                console.log('âœ… TTSService åŠ è½½æˆåŠŸ');
            }
        }, 100);
    </script>
    
    <!-- å¼•å…¥é”™è¯ç®¡ç†å™¨ -->
    <script src="src/utils/MissedWordsManager.js?v=20251015" onerror="console.error('âŒ MissedWordsManager.js åŠ è½½å¤±è´¥')"></script>

    <script src="src/core/vocabulary-config-loader.js?v=20251107-extbooks"></script>
    <script src="src/core/vocabulary-manager-v2.js?v=20251130"></script>
    <!-- ç³»ç»Ÿæ¨¡å— -->
    <script src="src/systems/GameRenderer.js"></script>
    <script src="src/systems/CannonSystem.js"></script>
    <script src="src/systems/ExplosionSystem.js"></script>
    <script src="src/core/WordTetrisGame.js?v=20251107"></script>
    <script src="src/core/game-settings-integration.js?v=20251009-2"></script>
</body>
</html>
