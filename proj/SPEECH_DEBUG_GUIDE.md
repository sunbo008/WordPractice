# 🔊 语音朗读功能调试指南

## 🎯 问题诊断步骤

### 1. 打开浏览器控制台

**Chrome/Edge**：按 `F12` 或 `Ctrl+Shift+I` (Windows) / `Cmd+Option+I` (Mac)

**Safari**：
1. 先启用开发菜单：Safari → 偏好设置 → 高级 → 勾选"在菜单栏中显示开发菜单"
2. 按 `Cmd+Option+C` 打开控制台

**Firefox**：按 `F12` 或 `Ctrl+Shift+K` (Windows) / `Cmd+Option+K` (Mac)

---

### 2. 查看初始化日志

打开游戏页面后，控制台应该显示：

```
✅ 正确的日志：
初始化语音合成系统...
✅ 浏览器支持 Web Speech API
当前可用语音数量: X
正在选择语音，可用数量: X
可用语音示例: ["语音1", "语音2", ...]
✅ 已选择语音: XXX ( en-GB )

❌ 如果看到错误：
❌ 浏览器不支持语音合成功能
⚠️ 未找到合适的英语语音，将使用默认语音
```

---

### 3. 测试游戏中的朗读

1. 点击"开始游戏"
2. 观察控制台日志：

```
✅ 正确的日志（单词开始下降时）：
开始重复朗读: HOUSE
已发送朗读请求: HOUSE 语音: Google UK English Female
开始朗读: HOUSE
朗读完成: HOUSE

✅ 正确的日志（5秒后重复）：
定时重复朗读: HOUSE
已发送朗读请求: HOUSE 语音: Google UK English Female
开始朗读: HOUSE
朗读完成: HOUSE

❌ 可能的错误：
语音未启用或不支持
语音朗读错误: not-allowed
语音朗读错误: network
```

---

### 4. 使用测试页面诊断

打开 `proj/test-speech.html` 进行完整测试：

```
http://localhost:8000/test-speech.html
```

或在 Vercel 上：
```
https://your-project.vercel.app/test-speech.html
```

**测试步骤**：
1. 查看"浏览器支持检测"部分
2. 查看"可用语音列表"（应该有多个）
3. 点击"测试简单朗读" - 应该听到 "Hello"
4. 点击"测试英文单词" - 应该听到 "HOUSE"
5. 点击"测试英式发音" - 应该听到英式发音的 "HOUSE"
6. 点击"测试重复朗读" - 应该每5秒听到一次

---

## 🐛 常见问题和解决方案

### 问题 1：浏览器不支持语音合成

**症状**：
```
❌ 浏览器不支持语音合成功能
```

**解决方案**：
- 使用现代浏览器：Chrome 33+, Edge 14+, Safari 7+, Firefox 49+
- 更新浏览器到最新版本
- 尝试不同的浏览器

---

### 问题 2：没有可用语音

**症状**：
```
当前可用语音数量: 0
⏳ 语音列表未加载，等待 voiceschanged 事件...
```

**可能原因**：
1. 语音库未下载（首次使用）
2. 浏览器权限问题
3. 网络问题（某些浏览器需要在线下载语音）

**解决方案**：
1. **等待几秒钟** - 语音列表可能正在加载
2. **刷新页面** - 重新触发语音加载
3. **检查网络连接** - 某些浏览器需要联网
4. **在线环境测试** - 某些语音功能需要 HTTPS 或在线环境

---

### 问题 3：语音权限被拒绝

**症状**：
```
语音朗读错误: not-allowed
```

**解决方案**：

**Chrome**：
1. 点击地址栏左侧的锁图标
2. 找到"声音"权限
3. 设置为"允许"
4. 刷新页面

**Safari**：
1. Safari → 偏好设置 → 网站 → 自动播放
2. 找到您的网站
3. 设置为"允许所有自动播放"

**Firefox**：
1. 点击地址栏左侧的图标
2. 找到"权限"
3. 允许"自动播放音频"

---

### 问题 4：语音在 Vercel 上不工作

**可能原因**：
1. HTTPS 环境问题
2. 浏览器安全策略
3. 自动播放策略限制

**解决方案**：

1. **用户交互触发** - 确保用户先点击了"开始游戏"按钮（已实现）

2. **检查 HTTPS** - Vercel 默认使用 HTTPS，应该没问题

3. **测试不同浏览器** - 某些浏览器对自动播放限制更严格

4. **检查控制台** - 查看具体错误信息

---

### 问题 5：语音朗读但听不到

**症状**：
- 控制台显示"开始朗读"和"朗读完成"
- 但没有声音

**检查清单**：
- [ ] 系统音量是否打开？
- [ ] 浏览器标签页是否静音？（右键标签页检查）
- [ ] 耳机/扬声器是否正常？
- [ ] 尝试其他网站的声音（如 YouTube）
- [ ] 检查浏览器音量设置

---

### 问题 6：语音只播放一次，不重复

**症状**：
- 第一次听到声音
- 5秒后没有重复

**检查**：
```javascript
// 控制台应该显示：
定时重复朗读: HOUSE  // 每5秒一次
```

**如果没有显示**：
- 检查定时器是否被清除
- 检查游戏是否暂停
- 检查单词是否还在下降

---

## 🧪 详细测试步骤

### 测试 1：基本功能测试

1. 打开游戏
2. 按 F12 打开控制台
3. 查看是否有语音初始化日志
4. 点击"开始游戏"
5. 等待单词开始下降
6. 应该立即听到单词发音
7. 等待 5 秒，应该再次听到

**预期结果**：每 5 秒听到一次单词发音

---

### 测试 2：语音开关测试

1. 游戏进行中
2. 点击"🔊 语音开"按钮
3. 按钮变为"🔇 语音关"
4. 朗读停止
5. 再次点击按钮
6. 朗读恢复

**预期结果**：开关能正常控制语音

---

### 测试 3：暂停恢复测试

1. 游戏进行中，朗读正常
2. 点击"暂停"
3. 朗读停止
4. 点击"继续"
5. 朗读恢复

**预期结果**：暂停时停止，恢复时重新开始

---

### 测试 4：击中单词测试

1. 游戏进行中，朗读正常
2. 正确输入字母，击中单词
3. 朗读立即停止
4. 下一个单词开始下降
5. 立即开始朗读新单词

**预期结果**：击中后立即停止，新单词立即开始

---

### 测试 5：不同浏览器测试

在以下浏览器中测试：
- [ ] Chrome/Edge
- [ ] Safari
- [ ] Firefox

**记录每个浏览器的表现**

---

## 📊 诊断信息收集

如果遇到问题，收集以下信息：

### 1. 浏览器信息
```
浏览器: Chrome/Safari/Firefox/Edge
版本: xxx
操作系统: Windows/Mac/Linux
```

### 2. 控制台日志
复制完整的控制台输出，特别是：
- 初始化日志
- 错误信息
- 朗读日志

### 3. 可用语音信息
在控制台运行：
```javascript
speechSynthesis.getVoices().forEach(v => console.log(v.name, v.lang))
```

### 4. 测试页面结果
截图 `test-speech.html` 的测试结果

---

## 🔧 手动调试命令

在浏览器控制台运行这些命令进行手动测试：

### 检查语音支持
```javascript
console.log('支持语音合成:', 'speechSynthesis' in window);
```

### 列出所有语音
```javascript
speechSynthesis.getVoices().forEach(v => {
    console.log(`${v.name} (${v.lang})${v.default ? ' [默认]' : ''}`);
});
```

### 测试简单朗读
```javascript
const utterance = new SpeechSynthesisUtterance('Hello');
speechSynthesis.speak(utterance);
```

### 测试英文单词
```javascript
const utterance = new SpeechSynthesisUtterance('HOUSE');
utterance.lang = 'en-GB';
utterance.rate = 0.9;
speechSynthesis.speak(utterance);
```

### 检查游戏对象
```javascript
// 在游戏中，检查语音状态
console.log('语音启用:', game.speechEnabled);
console.log('选择的语音:', game.britishVoice);
console.log('当前单词:', game.fallingWords);
```

---

## ✅ 确认工作正常的标志

如果以下全部成立，说明语音功能正常：

1. ✅ 控制台显示"✅ 已选择语音"
2. ✅ 单词下降时立即听到朗读
3. ✅ 每 5 秒重复朗读一次
4. ✅ 击中/放弃时立即停止
5. ✅ 语音开关按钮工作正常
6. ✅ 暂停/恢复功能正常
7. ✅ 没有控制台错误

---

## 📞 获取帮助

如果按照以上步骤仍然无法解决问题，请提供：

1. 浏览器和版本信息
2. 完整的控制台日志截图
3. `test-speech.html` 的测试结果截图
4. 具体的错误信息

---

**祝您调试顺利！🎉**
