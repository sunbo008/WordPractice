# 🔍 调试日志使用指南

## 功能说明

游戏页面现在内置了一个实时调试日志面板，可以在页面上直接查看游戏运行时的详细日志信息，无需打开浏览器开发者工具。

## 使用方法

### 1. 打开游戏

直接打开 `proj/index.html` 文件，游戏页面会自动加载。

### 2. 查看调试日志面板

在游戏页面的右侧（错词本下方），你会看到一个黑色的调试日志面板：

```
🔍 调试日志
[隐藏] [清空]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
[时间] 🔍 调试日志系统已启动
[时间] 🎮 游戏初始化开始...
[时间] ✅ 游戏初始化完成
```

### 3. 控制按钮

- **隐藏/显示**：点击可以折叠或展开日志面板
- **清空**：清空当前所有日志内容

### 4. 日志类型

日志按照重要程度分为4种颜色：

- 🔵 **蓝色（info）**：普通信息，记录游戏流程
- 🟢 **绿色（success）**：成功操作，表示某个步骤完成
- 🟡 **黄色（warning）**：警告信息，需要注意但不影响运行
- 🔴 **红色（error）**：错误信息，表示出现问题

## 测试堆叠区问题

### 步骤1：开始游戏

1. 点击"开始游戏"按钮
2. 观察日志面板，应该看到：
   ```
   ✅ 游戏初始化完成
   ```

### 步骤2：让单词失败

1. **不要输入任何字母**
2. 让单词自然下降到底部
3. 观察日志面板，应该看到：

```
💥 单词失败: tree
   单词底部Y: 500, 堆叠区顶部Y: 500
   堆叠区当前单词数: 0
✅ 已从下降列表移除
✅ 已标记为失败（giveUp=false）
➡️ 准备调用 addToStack...
📦 addToStack: tree
   当前堆叠数: 0
📚 添加到错词本: tree
✅ 已添加到错词本
📦 添加到堆叠数组...
✅ 已添加到堆叠数组 (位置: row0, col0)
✅ 堆叠总数: 1
   堆叠列表: tree
✅ 验证成功：单词已在堆叠数组中
✅ addToStack 调用完成
📊 失败统计已更新，总失败数: 1
```

### 步骤3：检查结果

1. **查看游戏画面**：堆叠区底部应该显示失败的单词
2. **查看错词本**：右侧错词本应该显示该单词
3. **查看日志**：确认所有步骤都显示 ✅ 成功

## 常见问题诊断

### 问题1：单词没有显示在堆叠区

**检查日志中是否有：**
- ❌ `单词对象为空或undefined`
- ❌ `单词对象缺少original属性`
- ❌ `验证失败：单词未在堆叠数组中`

**如果有这些错误**：说明单词对象有问题，需要检查词汇管理器。

**如果没有错误，但堆叠区仍然是空的**：说明问题在渲染层，需要检查 `drawStackedWords()` 方法。

### 问题2：单词没有加入错词本

**检查日志中是否有：**
- ✅ `已添加到错词本`

**如果有这条日志但错词本仍然是空的**：说明错词本的显示逻辑有问题。

### 问题3：失败判定没有触发

**检查日志中是否有：**
- 💥 `单词失败: xxx`

**如果没有这条日志**：
- 检查单词是否真的下降到了底部
- 检查 `getStackTopY()` 计算是否正确
- 检查失败判定条件 `word.y + word.height >= stackTopY`

### 问题4：全局错误

如果出现JavaScript运行时错误，日志会自动捕获并显示：

```
❌ 全局错误: Cannot read property 'original' of undefined
   文件: game.js:1234:56
```

这可以帮助快速定位代码中的错误位置。

## 日志内容说明

### 单词失败流程

完整的单词失败流程应该包含以下日志：

1. **失败判定触发**
   ```
   💥 单词失败: [单词]
      单词底部Y: [Y坐标], 堆叠区顶部Y: [Y坐标]
      堆叠区当前单词数: [数量]
   ```

2. **从下降列表移除**
   ```
   ✅ 已从下降列表移除
   ✅ 已标记为失败（giveUp=false）
   ```

3. **添加到堆叠区**
   ```
   ➡️ 准备调用 addToStack...
   📦 addToStack: [单词]
      当前堆叠数: [数量]
   ```

4. **添加到错词本**
   ```
   📚 添加到错词本: [单词]
   ✅ 已添加到错词本
   ```

5. **添加到堆叠数组**
   ```
   📦 添加到堆叠数组...
   ✅ 已添加到堆叠数组 (位置: row[行], col[列])
   ✅ 堆叠总数: [数量]
      堆叠列表: [单词列表]
   ```

6. **验证成功**
   ```
   ✅ 验证成功：单词已在堆叠数组中
   ✅ addToStack 调用完成
   ```

7. **更新统计**
   ```
   📊 失败统计已更新，总失败数: [数量]
   ```

### 用户放弃单词流程

当用户按空格键放弃单词时：

```
🚫 用户放弃单词
🚫 放弃单词: [单词]
   堆叠区当前数量: [数量]
➡️ 准备调用 addToStack
📦 addToStack: [单词]
   ... (同上)
✅ 放弃处理完成，堆叠区数量: [数量]
```

## 性能说明

- 日志面板最多保留 **200 条**日志，超过后会自动删除最旧的日志
- 日志会同时输出到页面和浏览器控制台（F12）
- 可以随时点击"清空"按钮清除日志
- 可以点击"隐藏"按钮折叠面板以节省屏幕空间

## 导出日志

如果需要保存日志用于分析：

1. 打开浏览器开发者工具（F12）
2. 切换到 Console 标签
3. 右键点击日志内容
4. 选择"Save as..."保存为文本文件

## 关闭调试日志

如果不需要调试日志，可以：

1. 点击"隐藏"按钮折叠面板
2. 或者在 `game.js` 中设置：
   ```javascript
   const debugLog = new DebugLogger();
   debugLog.enabled = false;  // 禁用日志
   ```

## 技术细节

### 错误捕获

调试日志系统会自动捕获：

1. **全局JavaScript错误**
   ```javascript
   window.addEventListener('error', ...)
   ```

2. **Promise拒绝错误**
   ```javascript
   window.addEventListener('unhandledrejection', ...)
   ```

3. **游戏逻辑中的手动日志**
   ```javascript
   debugLog.info('信息')
   debugLog.success('成功')
   debugLog.warning('警告')
   debugLog.error('错误')
   ```

### 日志格式

每条日志包含：
- **时间戳**：`[HH:MM:SS]`
- **内容**：日志消息
- **颜色**：根据日志类型自动着色

## 总结

使用调试日志面板，你可以：

✅ 实时查看游戏运行状态  
✅ 快速定位问题所在  
✅ 无需打开开发者工具  
✅ 自动捕获运行时错误  
✅ 验证功能是否正常工作  

现在就打开游戏，让单词失败，看看日志面板会显示什么吧！🎮
