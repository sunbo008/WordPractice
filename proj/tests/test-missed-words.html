<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é”™è¯åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
        }
        h2 {
            color: #666;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #2980b9;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            background: #ecf0f1;
            border-radius: 5px;
            font-family: monospace;
        }
        .success {
            color: #27ae60;
        }
        .error {
            color: #e74c3c;
        }
        .info {
            color: #3498db;
        }
        pre {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª é”™è¯åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>1. IP è·å–æµ‹è¯•</h2>
        <button onclick="testGetIP()">è·å– IP</button>
        <div id="ip-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>2. ä¿å­˜é”™è¯æµ‹è¯•</h2>
        <button onclick="testSaveSingleWord()">ä¿å­˜å•ä¸ªé”™è¯</button>
        <button onclick="testSaveBatchWords()">æ‰¹é‡ä¿å­˜é”™è¯</button>
        <div id="save-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>3. è¯»å–é”™è¯æµ‹è¯•</h2>
        <button onclick="testGetWords()">è¯»å–æ‰€æœ‰é”™è¯</button>
        <button onclick="testGetWordsCount()">è·å–é”™è¯æ•°é‡</button>
        <div id="get-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>4. æ–‡ä»¶è§£ææµ‹è¯•</h2>
        <button onclick="testParseTxt()">è§£æ TXT æ ¼å¼</button>
        <button onclick="testParseCsv()">è§£æ CSV æ ¼å¼</button>
        <button onclick="testParseJson()">è§£æ JSON æ ¼å¼</button>
        <div id="parse-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>5. æ¸…ç©ºæµ‹è¯•</h2>
        <button onclick="testClearWords()">æ¸…ç©ºæ‰€æœ‰é”™è¯</button>
        <div id="clear-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>6. localStorage æŸ¥çœ‹</h2>
        <button onclick="viewLocalStorage()">æŸ¥çœ‹ localStorage</button>
        <button onclick="clearLocalStorage()">æ¸…ç©º localStorage</button>
        <div id="storage-result" class="result"></div>
    </div>

    <!-- åŠ è½½é”™è¯ç®¡ç†å™¨ -->
    <script src="../src/utils/MissedWordsManager.js"></script>
    
    <script>
        const manager = window.missedWordsManager;
        
        // æµ‹è¯•1: è·å–IP
        async function testGetIP() {
            const result = document.getElementById('ip-result');
            result.innerHTML = 'æ­£åœ¨è·å– IP...';
            
            try {
                const ip = await manager.getUserIP();
                result.innerHTML = `<span class="success">âœ… IPè·å–æˆåŠŸ: ${ip}</span>`;
            } catch (error) {
                result.innerHTML = `<span class="error">âŒ IPè·å–å¤±è´¥: ${error.message}</span>`;
            }
        }
        
        // æµ‹è¯•2: ä¿å­˜å•ä¸ªé”™è¯æ–‡ä»¶
        async function testSaveSingleWord() {
            const result = document.getElementById('save-result');
            result.innerHTML = 'æ­£åœ¨ä¿å­˜...';
            
            // æ¨¡æ‹Ÿå¯¼å…¥ä¸€ä¸ªæ–‡ä»¶ï¼ˆæ–‡ä»¶åä½œä¸ºé”™è¯å¡åç§°ï¼‰
            const fileName = 'æµ‹è¯•æ–‡ä»¶1';
            const summary = 'åŒ…å« 3 ä¸ªå•è¯';
            const wordList = 'hello, world, good';
            
            const testWord = {
                word: fileName,
                phonetic: summary,
                meaning: wordList
            };
            
            try {
                const success = await manager.saveMissedWord(testWord);
                if (success) {
                    result.innerHTML = `<span class="success">âœ… ä¿å­˜æˆåŠŸ: ${testWord.word}</span>`;
                } else {
                    result.innerHTML = `<span class="error">âŒ ä¿å­˜å¤±è´¥</span>`;
                }
            } catch (error) {
                result.innerHTML = `<span class="error">âŒ é”™è¯¯: ${error.message}</span>`;
            }
        }
        
        // æµ‹è¯•3: æ‰¹é‡ä¿å­˜é”™è¯æ–‡ä»¶
        async function testSaveBatchWords() {
            const result = document.getElementById('save-result');
            result.innerHTML = 'æ­£åœ¨æ‰¹é‡ä¿å­˜...';
            
            // æ¨¡æ‹Ÿå¯¼å…¥å¤šä¸ªæ–‡ä»¶
            const testFiles = [
                { word: 'æµ‹è¯•æ–‡ä»¶2', phonetic: 'åŒ…å« 5 ä¸ªå•è¯', meaning: 'apple, banana, orange, grape, pear' },
                { word: 'æµ‹è¯•æ–‡ä»¶3', phonetic: 'åŒ…å« 4 ä¸ªå•è¯', meaning: 'cat, dog, bird, fish' },
                { word: 'æµ‹è¯•æ–‡ä»¶4', phonetic: 'åŒ…å« 3 ä¸ªå•è¯', meaning: 'red, blue, green' }
            ];
            
            try {
                const count = await manager.saveMissedWords(testFiles);
                result.innerHTML = `<span class="success">âœ… æ‰¹é‡ä¿å­˜æˆåŠŸ: ${count}/${testFiles.length} ä¸ªæ–‡ä»¶</span>`;
            } catch (error) {
                result.innerHTML = `<span class="error">âŒ é”™è¯¯: ${error.message}</span>`;
            }
        }
        
        // æµ‹è¯•4: è¯»å–æ‰€æœ‰é”™è¯
        async function testGetWords() {
            const result = document.getElementById('get-result');
            result.innerHTML = 'æ­£åœ¨è¯»å–...';
            
            try {
                const words = await manager.getMissedWords();
                result.innerHTML = `
                    <span class="info">ğŸ“ å…± ${words.length} ä¸ªé”™è¯:</span>
                    <pre>${JSON.stringify(words, null, 2)}</pre>
                `;
            } catch (error) {
                result.innerHTML = `<span class="error">âŒ é”™è¯¯: ${error.message}</span>`;
            }
        }
        
        // æµ‹è¯•5: è·å–é”™è¯æ•°é‡
        async function testGetWordsCount() {
            const result = document.getElementById('get-result');
            result.innerHTML = 'æ­£åœ¨ç»Ÿè®¡...';
            
            try {
                const count = await manager.getMissedWordsCount();
                result.innerHTML = `<span class="info">ğŸ“Š é”™è¯æ•°é‡: ${count}</span>`;
            } catch (error) {
                result.innerHTML = `<span class="error">âŒ é”™è¯¯: ${error.message}</span>`;
            }
        }
        
        // æµ‹è¯•6: è§£æ TXT æ ¼å¼
        function testParseTxt() {
            const result = document.getElementById('parse-result');
            const content = `hello, /hÉ™ËˆlÉ™ÊŠ/, ä½ å¥½
world, /wÉœËld/, ä¸–ç•Œ
good, /É¡ÊŠd/, å¥½çš„`;
            
            try {
                // æ¨¡æ‹Ÿæ–‡ä»¶è§£æï¼ˆéœ€è¦settings.jsä¸­çš„parseImportFileæ–¹æ³•ï¼‰
                result.innerHTML = `
                    <span class="info">ğŸ“„ TXT æ ¼å¼ç¤ºä¾‹:</span>
                    <pre>${content}</pre>
                    <span class="success">âœ… æ ¼å¼æ­£ç¡®ï¼Œæ¯è¡Œæ ¼å¼ï¼šå•è¯, éŸ³æ ‡, ä¸­æ–‡ç¿»è¯‘</span>
                `;
            } catch (error) {
                result.innerHTML = `<span class="error">âŒ é”™è¯¯: ${error.message}</span>`;
            }
        }
        
        // æµ‹è¯•7: è§£æ CSV æ ¼å¼
        function testParseCsv() {
            const result = document.getElementById('parse-result');
            const content = `word,phonetic,meaning
hello,/hÉ™ËˆlÉ™ÊŠ/,ä½ å¥½
world,/wÉœËld/,ä¸–ç•Œ`;
            
            result.innerHTML = `
                <span class="info">ğŸ“„ CSV æ ¼å¼ç¤ºä¾‹:</span>
                <pre>${content}</pre>
                <span class="success">âœ… æ ¼å¼æ­£ç¡®ï¼Œé¦–è¡Œä¸ºæ ‡é¢˜ï¼Œåç»­æ¯è¡Œä¸€ä¸ªå•è¯</span>
            `;
        }
        
        // æµ‹è¯•8: è§£æ JSON æ ¼å¼
        function testParseJson() {
            const result = document.getElementById('parse-result');
            const content = `[
  {"word": "hello", "phonetic": "/hÉ™ËˆlÉ™ÊŠ/", "meaning": "ä½ å¥½"},
  {"word": "world", "phonetic": "/wÉœËld/", "meaning": "ä¸–ç•Œ"}
]`;
            
            result.innerHTML = `
                <span class="info">ğŸ“„ JSON æ ¼å¼ç¤ºä¾‹:</span>
                <pre>${content}</pre>
                <span class="success">âœ… æ ¼å¼æ­£ç¡®ï¼Œæ•°ç»„æ ¼å¼ï¼Œæ¯ä¸ªå¯¹è±¡åŒ…å« word/phonetic/meaning</span>
            `;
        }
        
        // æµ‹è¯•9: æ¸…ç©ºé”™è¯
        function testClearWords() {
            const result = document.getElementById('clear-result');
            
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰é”™è¯å—ï¼Ÿ')) {
                try {
                    localStorage.removeItem('wordTetris_missedWords');
                    result.innerHTML = `<span class="success">âœ… å·²æ¸…ç©ºæ‰€æœ‰é”™è¯</span>`;
                } catch (error) {
                    result.innerHTML = `<span class="error">âŒ é”™è¯¯: ${error.message}</span>`;
                }
            }
        }
        
        // æµ‹è¯•10: æŸ¥çœ‹ localStorage
        function viewLocalStorage() {
            const result = document.getElementById('storage-result');
            
            try {
                const data = localStorage.getItem('wordTetris_missedWords');
                if (data) {
                    const parsed = JSON.parse(data);
                    result.innerHTML = `
                        <span class="info">ğŸ’¾ localStorage å†…å®¹:</span>
                        <pre>${JSON.stringify(parsed, null, 2)}</pre>
                    `;
                } else {
                    result.innerHTML = `<span class="info">ğŸ’¾ localStorage ä¸ºç©º</span>`;
                }
            } catch (error) {
                result.innerHTML = `<span class="error">âŒ é”™è¯¯: ${error.message}</span>`;
            }
        }
        
        // æµ‹è¯•11: æ¸…ç©º localStorage
        function clearLocalStorage() {
            const result = document.getElementById('storage-result');
            
            if (confirm('ç¡®å®šè¦æ¸…ç©º localStorage å—ï¼Ÿ')) {
                try {
                    localStorage.removeItem('wordTetris_missedWords');
                    result.innerHTML = `<span class="success">âœ… å·²æ¸…ç©º localStorage</span>`;
                } catch (error) {
                    result.innerHTML = `<span class="error">âŒ é”™è¯¯: ${error.message}</span>`;
                }
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è·å–IP
        window.addEventListener('DOMContentLoaded', async () => {
            console.log('ğŸ§ª é”™è¯åŠŸèƒ½æµ‹è¯•é¡µé¢å·²åŠ è½½');
            await testGetIP();
        });
    </script>
</body>
</html>

