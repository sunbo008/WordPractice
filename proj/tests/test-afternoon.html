<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æµ‹è¯• afternoon</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 40px;
            background: #1e3c72;
            color: white;
        }
        .word {
            font-size: 64px;
            margin: 20px 0;
        }
        .stress { color: #ff4444; }
        .normal { color: #ffffff; }
        .info {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>æµ‹è¯• afternoon é‡éŸ³è¯†åˆ«</h1>
    
    <div class="info">
        <h3>å•è¯ä¿¡æ¯</h3>
        <p><strong>å•è¯:</strong> afternoon</p>
        <p><strong>éŸ³æ ‡:</strong> <span id="phonetic"></span></p>
        <p><strong>é‡éŸ³åº”è¯¥åœ?</strong> noon (ååŠéƒ¨åˆ†)</p>
    </div>
    
    <div class="word" id="result"></div>
    
    <div class="info">
        <h3>è¯†åˆ«ç»“æœ</h3>
        <p><strong>è¯†åˆ«çš„é‡éŸ³ä½ç½?</strong> <span id="positions"></span></p>
        <p><strong>å¯¹åº”å­—æ¯:</strong> <span id="letters"></span></p>
    </div>
    
    <script>
        function getWholeSyllable(word, vowelIndex) {
            const vowels = 'aeiou';
            const result = [];
            
            let centerVowel = vowelIndex;
            if (!vowels.includes(word[centerVowel])) {
                for (let i = centerVowel; i < word.length; i++) {
                    if (vowels.includes(word[i])) {
                        centerVowel = i;
                        break;
                    }
                }
                if (!vowels.includes(word[centerVowel])) {
                    return Array.from({length: word.length}, (_, i) => i);
                }
            }
            
            let left = centerVowel;
            while (left > 0 && !vowels.includes(word[left - 1])) {
                left--;
            }
            
            let right = centerVowel;
            while (right < word.length - 1 && vowels.includes(word[right + 1])) {
                right++;
            }
            
            let consonantCount = 0;
            let tempRight = right;
            while (tempRight < word.length - 1 && !vowels.includes(word[tempRight + 1])) {
                consonantCount++;
                tempRight++;
            }
            
            if (tempRight < word.length - 1) {
                right += Math.ceil(consonantCount / 2);
            } else {
                right = tempRight;
            }
            
            for (let i = left; i <= right && i < word.length; i++) {
                result.push(i);
            }
            
            return result;
        }
        
        function getStressPositions(word, phonetic) {
            if (!word || !phonetic) {
                return [];
            }
            
            const lowerWord = word.toLowerCase();
            console.log('å•è¯:', lowerWord);
            console.log('éŸ³æ ‡:', phonetic);
            
            const stressPattern = /[ËˆËŒ]([É™Ã¦É‘É’É”ÉªiËÉœÉ›eÊŠuËÊŒÉ”ËÉªÉ™eÉªaÉªÉ”ÉªÉ™ÊŠeÉ™ÉªÉ™ÊŠÉ™aÊŠ]+)/g;
            const matches = [];
            let match;
            
            while ((match = stressPattern.exec(phonetic)) !== null) {
                matches.push({
                    index: match.index,
                    vowelSound: match[1],
                    type: phonetic[match.index],
                    fullMatch: match[0]
                });
                console.log('æ‰¾åˆ°é‡éŸ³:', match[0], 'ä½ç½®:', match.index, 'ç±»å‹:', phonetic[match.index]);
            }
            
            if (matches.length === 0) {
                const vowels = 'aeiou';
                for (let i = 0; i < lowerWord.length; i++) {
                    if (vowels.includes(lowerWord[i])) {
                        return getWholeSyllable(lowerWord, i);
                    }
                }
                return Array.from({length: lowerWord.length}, (_, i) => i);
            }
            
            const result = [];
            const vowels = 'aeiou';
            
            matches.forEach((stressMatch, idx) => {
                const beforeStress = phonetic.substring(0, stressMatch.index);
                const syllablesBefore = (beforeStress.match(/[É™Ã¦É‘É’É”ÉªiËÉœÉ›eÊŠuËÊŒÉ”ËaÊŠ]+/g) || []).length;
                
                console.log(`é‡éŸ³ ${idx + 1}:`, stressMatch.type, stressMatch.fullMatch);
                console.log('  å‰é¢çš„éŸ³æ ?', beforeStress);
                console.log('  å‰é¢çš„éŸ³èŠ‚æ•°:', syllablesBefore);
                
                let vowelCount = 0;
                for (let i = 0; i < lowerWord.length; i++) {
                    if (vowels.includes(lowerWord[i])) {
                        console.log(`  å…ƒéŸ³ ${vowelCount}: ${lowerWord[i]} at ${i}`);
                        if (vowelCount === syllablesBefore) {
                            console.log(`  âœ?åŒ¹é…ï¼æ‰¾åˆ°ç¬¬ ${syllablesBefore} ä¸ªå…ƒéŸ³`);
                            const syllablePositions = getWholeSyllable(lowerWord, i);
                            console.log('  éŸ³èŠ‚èŒƒå›´:', syllablePositions);
                            syllablePositions.forEach(pos => {
                                if (!result.includes(pos)) {
                                    result.push(pos);
                                }
                            });
                            break;
                        }
                        vowelCount++;
                    }
                }
            });
            
            if (result.length === 0) {
                const vowels = 'aeiou';
                for (let i = 0; i < lowerWord.length; i++) {
                    if (vowels.includes(lowerWord[i])) {
                        return getWholeSyllable(lowerWord, i);
                    }
                }
            }
            
            return result.sort((a, b) => a - b);
        }
        
        // æµ‹è¯•ä¸åŒçš„éŸ³æ ‡æ ¼å¼?
        const testCases = [
            { phonetic: '[ËŒÉ‘ËftÉ™ËˆnuËn]', description: 'æ ‡å‡†éŸ³æ ‡ï¼ˆè‹±å¼ï¼‰' },
            { phonetic: '[ËŒÃ¦ftÉ™rËˆnuËn]', description: 'ç¾å¼éŸ³æ ‡' },
            { phonetic: '[É‘ËftÉ™ËˆnuËn]', description: 'åªæœ‰ä¸»é‡éŸ? },
            { phonetic: '[ËˆÉ‘ËftÉ™nuËn]', description: 'é‡éŸ³åœ¨å‰ï¼ˆé”™è¯¯ç¤ºä¾‹ï¼‰' }
        ];
        
        const word = 'afternoon';
        let html = '<h2>æµ‹è¯•ä¸åŒéŸ³æ ‡æ ¼å¼</h2>';
        
        testCases.forEach((testCase, idx) => {
            console.log(`\n=== æµ‹è¯• ${idx + 1}: ${testCase.description} ===`);
            const positions = getStressPositions(word, testCase.phonetic);
            const letters = positions.map(i => word[i]).join('');
            
            html += `<div class="info">`;
            html += `<h4>${testCase.description}</h4>`;
            html += `<p>éŸ³æ ‡: ${testCase.phonetic}</p>`;
            html += `<p>è¯†åˆ«ä½ç½®: [${positions.join(', ')}] â†?"${letters}"</p>`;
            html += `<div style="font-size: 48px;">`;
            for (let i = 0; i < word.length; i++) {
                if (positions.includes(i)) {
                    html += `<span class="stress">${word[i]}</span>`;
                } else {
                    html += `<span class="normal">${word[i]}</span>`;
                }
            }
            html += `</div>`;
            html += `</div>`;
        });
        
        document.getElementById('result').innerHTML = html;
    </script>
</body>
</html>

