<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯­éŸ³æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            padding: 12px 24px;
            margin: 10px 5px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            background: #4CAF50;
            color: white;
        }
        button:hover {
            background: #45a049;
        }
        .info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .error {
            background: #ffebee;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            color: #c62828;
        }
        .success {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            color: #2e7d32;
        }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ”Š è¯­éŸ³æœ—è¯»åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>1. æµè§ˆå™¨æ”¯æŒæ£€æµ?/h2>
        <div id="supportInfo"></div>
    </div>

    <div class="test-section">
        <h2>2. å¯ç”¨è¯­éŸ³åˆ—è¡¨</h2>
        <div id="voicesList"></div>
    </div>

    <div class="test-section">
        <h2>3. æµ‹è¯•æœ—è¯»</h2>
        <button onclick="testSimpleSpeech()">æµ‹è¯•ç®€å•æœ—è¯?/button>
        <button onclick="testEnglishWord()">æµ‹è¯•è‹±æ–‡å•è¯ (HOUSE)</button>
        <button onclick="testBritishVoice()">æµ‹è¯•è‹±å¼å‘éŸ³</button>
        <button onclick="testRepeated()">æµ‹è¯•é‡å¤æœ—è¯»ï¼?ç§’é—´éš”ï¼‰</button>
        <button onclick="stopAll()">åœæ­¢æ‰€æœ‰æœ—è¯?/button>
        <div id="testResult"></div>
    </div>

    <div class="test-section">
        <h2>4. è°ƒè¯•ä¿¡æ¯</h2>
        <div id="debugInfo"></div>
    </div>

    <script>
        let testTimer = null;
        let britishVoice = null;

        // 1. æ£€æµ‹æµè§ˆå™¨æ”¯æŒ
        function checkSupport() {
            const supportDiv = document.getElementById('supportInfo');
            
            if ('speechSynthesis' in window) {
                supportDiv.innerHTML = '<div class="success">âœ?æµè§ˆå™¨æ”¯æŒ?Web Speech API</div>';
                
                // ç­‰å¾…è¯­éŸ³åˆ—è¡¨åŠ è½½
                if (window.speechSynthesis.getVoices().length === 0) {
                    supportDiv.innerHTML += '<div class="info">â?æ­£åœ¨åŠ è½½è¯­éŸ³åˆ—è¡¨...</div>';
                    window.speechSynthesis.addEventListener('voiceschanged', loadVoices);
                } else {
                    loadVoices();
                }
            } else {
                supportDiv.innerHTML = '<div class="error">â?æµè§ˆå™¨ä¸æ”¯æŒ Web Speech API</div>';
            }
        }

        // 2. åŠ è½½å¯ç”¨è¯­éŸ³
        function loadVoices() {
            const voices = window.speechSynthesis.getVoices();
            const voicesDiv = document.getElementById('voicesList');
            
            if (voices.length === 0) {
                voicesDiv.innerHTML = '<div class="error">â?æ²¡æœ‰å¯ç”¨çš„è¯­éŸ?/div>';
                return;
            }

            let html = '<div class="success">âœ?æ‰¾åˆ° ' + voices.length + ' ä¸ªå¯ç”¨è¯­éŸ?/div>';
            html += '<pre>';
            
            voices.forEach((voice, index) => {
                html += `${index + 1}. ${voice.name} (${voice.lang})`;
                if (voice.default) html += ' [é»˜è®¤]';
                if (voice.lang === 'en-GB' || voice.name.includes('British') || voice.name.includes('UK')) {
                    html += ' â­?[è‹±å¼]';
                    if (!britishVoice) britishVoice = voice;
                }
                html += '\n';
            });
            
            html += '</pre>';
            voicesDiv.innerHTML = html;

            // æ˜¾ç¤ºé€‰æ‹©çš„è‹±å¼è¯­éŸ?            if (britishVoice) {
                voicesDiv.innerHTML += `<div class="success">âœ?å·²é€‰æ‹©è‹±å¼è¯­éŸ³: ${britishVoice.name}</div>`;
            } else {
                const anyEnglish = voices.find(v => v.lang.startsWith('en-'));
                if (anyEnglish) {
                    britishVoice = anyEnglish;
                    voicesDiv.innerHTML += `<div class="info">â„¹ï¸ ä½¿ç”¨è‹±è¯­è¯­éŸ³: ${anyEnglish.name}</div>`;
                } else {
                    voicesDiv.innerHTML += `<div class="error">â?æ²¡æœ‰æ‰¾åˆ°è‹±è¯­è¯­éŸ³</div>`;
                }
            }
        }

        // 3. æµ‹è¯•ç®€å•æœ—è¯?        function testSimpleSpeech() {
            const resultDiv = document.getElementById('testResult');
            resultDiv.innerHTML = '<div class="info">ğŸ”Š æ­£åœ¨æœ—è¯»: "Hello"</div>';
            
            const utterance = new SpeechSynthesisUtterance('Hello');
            window.speechSynthesis.speak(utterance);
            
            utterance.onend = () => {
                resultDiv.innerHTML += '<div class="success">âœ?æœ—è¯»å®Œæˆ</div>';
            };
            
            utterance.onerror = (event) => {
                resultDiv.innerHTML += '<div class="error">â?æœ—è¯»å¤±è´¥: ' + event.error + '</div>';
            };
        }

        // 4. æµ‹è¯•è‹±æ–‡å•è¯
        function testEnglishWord() {
            const resultDiv = document.getElementById('testResult');
            resultDiv.innerHTML = '<div class="info">ğŸ”Š æ­£åœ¨æœ—è¯»: "HOUSE"</div>';
            
            const utterance = new SpeechSynthesisUtterance('HOUSE');
            utterance.lang = 'en-GB';
            utterance.rate = 0.9;
            
            window.speechSynthesis.speak(utterance);
            
            utterance.onend = () => {
                resultDiv.innerHTML += '<div class="success">âœ?æœ—è¯»å®Œæˆ</div>';
            };
            
            utterance.onerror = (event) => {
                resultDiv.innerHTML += '<div class="error">â?æœ—è¯»å¤±è´¥: ' + event.error + '</div>';
            };
        }

        // 5. æµ‹è¯•è‹±å¼å‘éŸ³
        function testBritishVoice() {
            const resultDiv = document.getElementById('testResult');
            
            if (!britishVoice) {
                resultDiv.innerHTML = '<div class="error">â?æ²¡æœ‰å¯ç”¨çš„è‹±å¼è¯­éŸ?/div>';
                return;
            }
            
            resultDiv.innerHTML = `<div class="info">ğŸ”Š ä½¿ç”¨ ${britishVoice.name} æœ—è¯»: "HOUSE"</div>`;
            
            const utterance = new SpeechSynthesisUtterance('HOUSE');
            utterance.voice = britishVoice;
            utterance.lang = 'en-GB';
            utterance.rate = 0.9;
            
            window.speechSynthesis.speak(utterance);
            
            utterance.onend = () => {
                resultDiv.innerHTML += '<div class="success">âœ?æœ—è¯»å®Œæˆ</div>';
            };
            
            utterance.onerror = (event) => {
                resultDiv.innerHTML += '<div class="error">â?æœ—è¯»å¤±è´¥: ' + event.error + '</div>';
            };
        }

        // 6. æµ‹è¯•é‡å¤æœ—è¯»
        function testRepeated() {
            const resultDiv = document.getElementById('testResult');
            stopAll(); // å…ˆåœæ­¢ä¹‹å‰çš„
            
            let count = 1;
            resultDiv.innerHTML = `<div class="info">ğŸ”Š å¼€å§‹é‡å¤æœ—è¯?"HOUSE"ï¼ˆæ¯5ç§’ä¸€æ¬¡ï¼‰</div>`;
            
            function speak() {
                const utterance = new SpeechSynthesisUtterance('HOUSE');
                if (britishVoice) {
                    utterance.voice = britishVoice;
                }
                utterance.lang = 'en-GB';
                utterance.rate = 0.9;
                
                window.speechSynthesis.speak(utterance);
                resultDiv.innerHTML += `<div class="info">ğŸ”Š ç¬?${count} æ¬¡æœ—è¯?/div>`;
                count++;
            }
            
            speak(); // ç«‹å³æ’­æ”¾ç¬¬ä¸€æ¬?            testTimer = setInterval(speak, 5000); // æ¯?ç§’é‡å¤?            
            resultDiv.innerHTML += '<div class="success">âœ?å·²å¯åŠ¨é‡å¤æœ—è¯»ï¼ˆç‚¹å‡»"åœæ­¢æ‰€æœ‰æœ—è¯?åœæ­¢ï¼?/div>';
        }

        // 7. åœæ­¢æ‰€æœ‰æœ—è¯?        function stopAll() {
            window.speechSynthesis.cancel();
            if (testTimer) {
                clearInterval(testTimer);
                testTimer = null;
            }
            const resultDiv = document.getElementById('testResult');
            resultDiv.innerHTML += '<div class="info">â¹ï¸ å·²åœæ­¢æ‰€æœ‰æœ—è¯?/div>';
        }

        // 8. æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
        function showDebugInfo() {
            const debugDiv = document.getElementById('debugInfo');
            const info = {
                'User Agent': navigator.userAgent,
                'è¯­éŸ³åˆæˆæ”¯æŒ': 'speechSynthesis' in window ? 'æ˜? : 'å?,
                'å¯ç”¨è¯­éŸ³æ•°é‡': window.speechSynthesis ? window.speechSynthesis.getVoices().length : 0,
                'æµè§ˆå™¨è¯­è¨€': navigator.language,
                'å¹³å°': navigator.platform
            };
            
            let html = '<pre>';
            for (const [key, value] of Object.entries(info)) {
                html += `${key}: ${value}\n`;
            }
            html += '</pre>';
            
            debugDiv.innerHTML = html;
        }

        // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œæ£€æµ?        window.addEventListener('load', () => {
            checkSupport();
            showDebugInfo();
        });
    </script>
</body>
</html>

