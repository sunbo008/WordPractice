<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è€ƒè¯•ç»Ÿè®¡æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .button:hover {
            background: #2980b9;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .exam-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            background: rgba(255,255,255,0.15);
            padding: 12px 20px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.2);
            margin: 15px 0;
        }
        .stats-item {
            text-align: center;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .stats-item .label {
            font-size: 0.95em;
            opacity: 0.9;
            color: #2c3e50;
        }
        .stats-item span:not(.label):not(.percentage) {
            font-size: 1.1em;
            font-weight: bold;
            color: #3498db;
        }
        .stats-item .percentage {
            font-size: 0.9em;
            color: #27ae60;
            font-weight: normal;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ è€ƒè¯•ç»Ÿè®¡æµ‹è¯•å·¥å…·</h1>
        <p>æµ‹è¯•è€ƒè¯•æ€»å•è¯é‡çš„è·å–å’Œæ˜¾ç¤º</p>
        
        <div class="test-section">
            <h3>å½“å‰è€ƒè¯•ç»Ÿè®¡</h3>
            <div class="exam-stats">
                <div class="stats-item">
                    <span class="label">è€ƒè¯•æ€»è¯é‡?</span>
                    <span id="total-words">0</span>
                </div>
                <div class="stats-item">
                    <span class="label">æ­£ç¡®å‘½ä¸­:</span>
                    <span id="hit-words">0</span>
                    <span class="percentage">(<span id="hit-percentage">0%</span>)</span>
                </div>
                <div class="stats-item">
                    <span class="label">è¦†ç›–ç?</span>
                    <span id="coverage-percentage">0%</span>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h3>æµ‹è¯•æ“ä½œ</h3>
            <button class="button" onclick="testVocabularyManager()">æµ‹è¯•å•è¯åº“ç®¡ç†å™¨</button>
            <button class="button" onclick="testGameStats()">æµ‹è¯•æ¸¸æˆç»Ÿè®¡</button>
            <button class="button" onclick="simulateHitWords()">æ¨¡æ‹Ÿå‘½ä¸­å•è¯</button>
            <button class="button" onclick="resetStats()">é‡ç½®ç»Ÿè®¡</button>
        </div>
        
        <div class="test-section">
            <h3>æµ‹è¯•ç»“æœ</h3>
            <div id="test-results"></div>
        </div>
        
        <div class="test-section">
            <h3>è°ƒè¯•ä¿¡æ¯</h3>
            <div id="debug-info"></div>
        </div>
    </div>

    <script src="../src/core/vocabulary-manager-v2.js"></script>
    <script>
        let vocabularyManager = null;
        let testHitWords = new Set();
        
        function updateStatus(message, type = 'info') {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }
        
        function updateDebugInfo(info) {
            const debugDiv = document.getElementById('debug-info');
            debugDiv.innerHTML = `<div class="status info"><pre>${info}</pre></div>`;
        }
        
        function updateExamStats(totalWords, hitWords) {
            const hitWordsCount = hitWords;
            const hitPercentage = totalWords > 0 ? Math.round((hitWordsCount / totalWords) * 100) : 0;
            const coveragePercentage = hitPercentage;
            
            document.getElementById('total-words').textContent = totalWords;
            document.getElementById('hit-words').textContent = hitWordsCount;
            document.getElementById('hit-percentage').textContent = `${hitPercentage}%`;
            document.getElementById('coverage-percentage').textContent = `${coveragePercentage}%`;
        }
        
        async function testVocabularyManager() {
            updateStatus('æ­£åœ¨æµ‹è¯•å•è¯åº“ç®¡ç†å™¨...', 'info');
            
            try {
                vocabularyManager = new VocabularyManager();
                
                // ç­‰å¾…åŠ è½½å®Œæˆ
                let waitCount = 0;
                while (!vocabularyManager.isLoaded && waitCount < 50) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                    waitCount++;
                }
                
                if (vocabularyManager.isLoaded) {
                    const stats = vocabularyManager.getVocabularyStats();
                    
                    updateStatus(`âœ?å•è¯åº“åŠ è½½æˆåŠŸï¼æ€»å•è¯æ•°: ${stats.totalWords}`, 'success');
                    updateExamStats(stats.totalWords, testHitWords.size);
                    
                    updateDebugInfo(`å•è¯åº“ç»Ÿè®?
æ€»å•è¯æ•°: ${stats.totalWords}
ç”Ÿè¯æœ¬æ•°é‡? ${stats.missedWords}
æ‰€æœ‰å•è¯æ•°ç»„é•¿åº? ${vocabularyManager.allWords ? vocabularyManager.allWords.length : 'null'}
åŠ è½½çŠ¶æ€? ${vocabularyManager.isLoaded}
åŠ è½½é”™è¯¯: ${vocabularyManager.loadError || 'none'}`);
                } else {
                    updateStatus('â?å•è¯åº“åŠ è½½å¤±è´¥æˆ–è¶…æ—¶', 'error');
                    updateDebugInfo(`åŠ è½½å¤±è´¥ä¿¡æ¯:
åŠ è½½çŠ¶æ€? ${vocabularyManager.isLoaded}
åŠ è½½é”™è¯¯: ${vocabularyManager.loadError || 'none'}
ç­‰å¾…æ¬¡æ•°: ${waitCount}`);
                }
            } catch (error) {
                updateStatus(`â?æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                updateDebugInfo(`é”™è¯¯è¯¦æƒ…: ${error.stack}`);
            }
        }
        
        async function testGameStats() {
            updateStatus('æ­£åœ¨æµ‹è¯•æ¸¸æˆç»Ÿè®¡é€»è¾‘...', 'info');
            
            if (!vocabularyManager || !vocabularyManager.isLoaded) {
                updateStatus('â?è¯·å…ˆæµ‹è¯•å•è¯åº“ç®¡ç†å™¨', 'error');
                return;
            }
            
            try {
                // æ¨¡æ‹Ÿæ¸¸æˆç»Ÿè®¡é€»è¾‘
                const stats = vocabularyManager.getVocabularyStats();
                const totalWords = stats.totalWords;
                const hitWordsCount = testHitWords.size;
                
                updateExamStats(totalWords, hitWordsCount);
                updateStatus(`âœ?æ¸¸æˆç»Ÿè®¡æµ‹è¯•æˆåŠŸï¼æ€»è¯é‡? ${totalWords}, å‘½ä¸­: ${hitWordsCount}`, 'success');
                
                updateDebugInfo(`æ¸¸æˆç»Ÿè®¡:
æ€»å•è¯æ•°: ${totalWords}
å‘½ä¸­å•è¯æ•? ${hitWordsCount}
å‘½ä¸­ç? ${totalWords > 0 ? Math.round((hitWordsCount / totalWords) * 100) : 0}%
æµ‹è¯•å‘½ä¸­å•è¯: [${Array.from(testHitWords).join(', ')}]`);
            } catch (error) {
                updateStatus(`â?æ¸¸æˆç»Ÿè®¡æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        function simulateHitWords() {
            // æ¨¡æ‹Ÿå‘½ä¸­ä¸€äº›å•è¯?
            const sampleWords = ['cat', 'dog', 'book', 'tree', 'house'];
            const randomWord = sampleWords[Math.floor(Math.random() * sampleWords.length)];
            
            testHitWords.add(randomWord);
            
            if (vocabularyManager && vocabularyManager.isLoaded) {
                const stats = vocabularyManager.getVocabularyStats();
                updateExamStats(stats.totalWords, testHitWords.size);
                updateStatus(`âœ?æ¨¡æ‹Ÿå‘½ä¸­å•è¯: ${randomWord}`, 'success');
            } else {
                updateStatus('â?è¯·å…ˆæµ‹è¯•å•è¯åº“ç®¡ç†å™¨', 'error');
            }
        }
        
        function resetStats() {
            testHitWords.clear();
            updateExamStats(0, 0);
            updateStatus('âœ?ç»Ÿè®¡å·²é‡ç½?, 'success');
            updateDebugInfo('ç»Ÿè®¡æ•°æ®å·²æ¸…ç©?);
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯?
        window.addEventListener('load', () => {
            updateStatus('é¡µé¢å·²åŠ è½½ï¼Œç‚¹å‡»"æµ‹è¯•å•è¯åº“ç®¡ç†å™¨"å¼€å§‹æµ‹è¯?, 'info');
        });
    </script>
</body>
</html>

