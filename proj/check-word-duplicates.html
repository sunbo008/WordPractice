<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•è¯é‡å¤æ£€æŸ¥å·¥å…·</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .duplicate-item {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 5px;
            padding: 10px;
            margin: 5px 0;
        }
        .duplicate-word {
            font-weight: bold;
            color: #721c24;
        }
        .difficulty-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .difficulty-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
        }
        .difficulty-title {
            font-weight: bold;
            margin-bottom: 10px;
        }
        .word-list {
            max-height: 200px;
            overflow-y: auto;
            font-size: 0.9em;
        }
        .test-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #2980b9;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” å•è¯é‡å¤æ£€æŸ¥å·¥å…·</h1>
        <p>æ£€æŸ¥å•è¯åº“ä¸­æ˜¯å¦å­˜åœ¨é‡å¤å•è¯ï¼Œç¡®ä¿æ¯ä¸ªå•è¯åªå‡ºç°åœ¨ä¸€ä¸ªéš¾åº¦çº§åˆ«ä¸­</p>
        
        <div id="status" class="status warning">å‡†å¤‡æ£€æŸ¥...</div>
        
        <button class="test-button" onclick="checkDuplicates()">å¼€å§‹æ£€æŸ¥é‡å¤</button>
        <button class="test-button" onclick="showDifficultyStats()">æ˜¾ç¤ºéš¾åº¦ç»Ÿè®¡</button>
        <button class="test-button" onclick="generateFixedWords()">ç”Ÿæˆä¿®å¤åçš„å•è¯åº“</button>
        
        <div id="results"></div>
        
        <div id="difficultyStats" class="difficulty-stats"></div>
    </div>

    <script>
        let wordsData = null;
        let allWords = [];
        
        async function loadWordsData() {
            try {
                const response = await fetch('./words.json');
                wordsData = await response.json();
                
                // å¤„ç†å•è¯æ•°æ®
                allWords = [];
                Object.entries(wordsData.phonicsLessons).forEach(([lessonKey, lesson]) => {
                    lesson.words.forEach(wordObj => {
                        allWords.push({
                            ...wordObj,
                            lesson: lessonKey,
                            lessonDescription: lesson.description
                        });
                    });
                });
                
                return true;
            } catch (error) {
                console.error('åŠ è½½å•è¯åº“å¤±è´¥:', error);
                return false;
            }
        }
        
        function updateStatus(message, type = 'warning') {
            const statusElement = document.getElementById('status');
            statusElement.textContent = message;
            statusElement.className = `status ${type}`;
        }
        
        async function checkDuplicates() {
            updateStatus('æ­£åœ¨åŠ è½½å•è¯åº“...', 'warning');
            
            const loaded = await loadWordsData();
            if (!loaded) {
                updateStatus('âŒ å•è¯åº“åŠ è½½å¤±è´¥', 'error');
                return;
            }
            
            updateStatus('æ­£åœ¨æ£€æŸ¥é‡å¤å•è¯...', 'warning');
            
            // æ£€æŸ¥é‡å¤å•è¯
            const wordMap = new Map();
            const duplicates = [];
            
            allWords.forEach(wordObj => {
                const word = wordObj.word.toLowerCase();
                if (wordMap.has(word)) {
                    // å‘ç°é‡å¤
                    const existing = wordMap.get(word);
                    if (!duplicates.find(d => d.word === word)) {
                        duplicates.push({
                            word: word,
                            occurrences: [existing, wordObj]
                        });
                    } else {
                        const duplicate = duplicates.find(d => d.word === word);
                        duplicate.occurrences.push(wordObj);
                    }
                } else {
                    wordMap.set(word, wordObj);
                }
            });
            
            // æ˜¾ç¤ºç»“æœ
            const resultsDiv = document.getElementById('results');
            
            if (duplicates.length === 0) {
                updateStatus('âœ… æ£€æŸ¥å®Œæˆï¼šæ²¡æœ‰å‘ç°é‡å¤å•è¯', 'success');
                resultsDiv.innerHTML = `
                    <div class="status success">
                        <h3>ğŸ‰ æ£€æŸ¥ç»“æœï¼šæ— é‡å¤</h3>
                        <p>å•è¯åº“ä¸­çš„ ${allWords.length} ä¸ªå•è¯éƒ½æ˜¯å”¯ä¸€çš„ï¼Œæ²¡æœ‰é‡å¤ã€‚</p>
                    </div>
                `;
            } else {
                updateStatus(`âŒ å‘ç° ${duplicates.length} ä¸ªé‡å¤å•è¯`, 'error');
                
                let duplicateHtml = `
                    <div class="status error">
                        <h3>âš ï¸ å‘ç°é‡å¤å•è¯</h3>
                        <p>æ‰¾åˆ° ${duplicates.length} ä¸ªé‡å¤çš„å•è¯ï¼Œéœ€è¦ä¿®å¤ï¼š</p>
                    </div>
                `;
                
                duplicates.forEach(duplicate => {
                    duplicateHtml += `
                        <div class="duplicate-item">
                            <div class="duplicate-word">"${duplicate.word}"</div>
                            <div>å‡ºç°åœ¨ä»¥ä¸‹ä½ç½®ï¼š</div>
                            <ul>
                    `;
                    
                    duplicate.occurrences.forEach(occurrence => {
                        duplicateHtml += `
                            <li>
                                <strong>${occurrence.lesson}</strong> (${occurrence.lessonDescription}) 
                                - éš¾åº¦: ${occurrence.difficulty}
                                - é‡Šä¹‰: ${occurrence.meaning}
                            </li>
                        `;
                    });
                    
                    duplicateHtml += `
                            </ul>
                        </div>
                    `;
                });
                
                resultsDiv.innerHTML = duplicateHtml;
            }
        }
        
        async function showDifficultyStats() {
            if (!wordsData) {
                const loaded = await loadWordsData();
                if (!loaded) return;
            }
            
            // æŒ‰éš¾åº¦ç»Ÿè®¡
            const difficultyStats = {
                1: { words: [], count: 0 },
                2: { words: [], count: 0 },
                3: { words: [], count: 0 }
            };
            
            allWords.forEach(wordObj => {
                const difficulty = wordObj.difficulty;
                if (difficultyStats[difficulty]) {
                    difficultyStats[difficulty].words.push(wordObj.word);
                    difficultyStats[difficulty].count++;
                }
            });
            
            // æ˜¾ç¤ºç»Ÿè®¡
            const statsDiv = document.getElementById('difficultyStats');
            let statsHtml = '<h3>ğŸ“Š éš¾åº¦çº§åˆ«ç»Ÿè®¡</h3>';
            
            Object.entries(difficultyStats).forEach(([difficulty, stats]) => {
                const difficultyNames = {
                    '1': 'åˆçº§ (Level 1-2)',
                    '2': 'ä¸­çº§ (Level 3-4)', 
                    '3': 'é«˜çº§ (Level 5+)'
                };
                
                statsHtml += `
                    <div class="difficulty-card">
                        <div class="difficulty-title">
                            éš¾åº¦ ${difficulty} - ${difficultyNames[difficulty]}
                        </div>
                        <div><strong>å•è¯æ•°é‡:</strong> ${stats.count}</div>
                        <div class="word-list">
                            <strong>å•è¯åˆ—è¡¨:</strong><br>
                            ${stats.words.join(', ')}
                        </div>
                    </div>
                `;
            });
            
            statsDiv.innerHTML = statsHtml;
        }
        
        async function generateFixedWords() {
            if (!wordsData) {
                const loaded = await loadWordsData();
                if (!loaded) return;
            }
            
            updateStatus('æ­£åœ¨ç”Ÿæˆä¿®å¤å»ºè®®...', 'warning');
            
            // è¿™é‡Œå¯ä»¥å®ç°è‡ªåŠ¨ä¿®å¤é€»è¾‘
            // ä¾‹å¦‚ï¼šå°†é‡å¤å•è¯åˆ†é…åˆ°ä¸åŒéš¾åº¦çº§åˆ«
            
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `
                <div class="status warning">
                    <h3>ğŸ”§ ä¿®å¤å»ºè®®</h3>
                    <p>åŸºäºå•è¯äº’æ–¥åŸåˆ™çš„ä¿®å¤å»ºè®®ï¼š</p>
                    <ol>
                        <li><strong>ä¿æŒéš¾åº¦1å•è¯çº¯å‡€</strong>ï¼šåªåŒ…å«æœ€åŸºç¡€çš„3-4å­—æ¯å•è¯</li>
                        <li><strong>éš¾åº¦2å•è¯ç‹¬ç«‹</strong>ï¼š4-6å­—æ¯å•è¯ï¼Œä¸ä¸éš¾åº¦1é‡å¤</li>
                        <li><strong>éš¾åº¦3å•è¯é«˜çº§</strong>ï¼š5-8å­—æ¯å¤æ‚å•è¯ï¼Œå®Œå…¨ç‹¬ç«‹</li>
                        <li><strong>é‡å¤å¤„ç†ç­–ç•¥</strong>ï¼š
                            <ul>
                                <li>ä¿ç•™åœ¨æœ€é€‚åˆçš„éš¾åº¦çº§åˆ«</li>
                                <li>ä»å…¶ä»–çº§åˆ«ä¸­ç§»é™¤</li>
                                <li>ç¡®ä¿æ¯ä¸ªçº§åˆ«æœ‰è¶³å¤Ÿçš„å•è¯æ•°é‡</li>
                            </ul>
                        </li>
                    </ol>
                </div>
            `;
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.addEventListener('load', () => {
            setTimeout(checkDuplicates, 1000);
        });
    </script>
</body>
</html>
