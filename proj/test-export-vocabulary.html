<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯¼å‡ºç”Ÿè¯åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .button:hover {
            background: #2980b9;
        }
        .button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .vocabulary-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            background: #f8f9fa;
        }
        .vocab-item {
            padding: 8px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
        }
        .vocab-item:last-child {
            border-bottom: none;
        }
        .word {
            font-weight: bold;
            color: #2c3e50;
        }
        .meaning {
            color: #7f8c8d;
        }
        .stats {
            font-size: 0.9em;
            color: #95a5a6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“¤ å¯¼å‡ºç”Ÿè¯åŠŸèƒ½æµ‹è¯•</h1>
        <p>æµ‹è¯•ç”Ÿè¯å¯¼å‡ºä¸ºæ–‡æœ¬æ–‡ä»¶çš„åŠŸèƒ½</p>
        
        <div class="test-section">
            <h3>å½“å‰ç”Ÿè¯æœ¬</h3>
            <div id="vocabulary-display" class="vocabulary-list">
                <p>æš‚æ— ç”Ÿè¯</p>
            </div>
            <p><strong>ç”Ÿè¯æ•°é‡ï¼š</strong><span id="vocab-count">0</span></p>
        </div>
        
        <div class="test-section">
            <h3>æµ‹è¯•æ“ä½œ</h3>
            <button class="button" onclick="loadVocabularyManager()">åŠ è½½å•è¯åº“</button>
            <button class="button" onclick="addTestWords()">æ·»åŠ æµ‹è¯•ç”Ÿè¯</button>
            <button class="button" onclick="clearVocabulary()">æ¸…ç©ºç”Ÿè¯æœ¬</button>
            <button class="button" id="exportBtn" onclick="exportVocabulary()" disabled>å¯¼å‡ºç”Ÿè¯</button>
        </div>
        
        <div class="test-section">
            <h3>æµ‹è¯•ç»“æœ</h3>
            <div id="test-results"></div>
        </div>
        
        <div class="test-section">
            <h3>å¯¼å‡ºæ–‡ä»¶é¢„è§ˆ</h3>
            <div id="export-preview"></div>
        </div>
    </div>

    <script src="vocabulary.js"></script>
    <script>
        let vocabularyManager = null;
        
        function updateStatus(message, type = 'info') {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }
        
        function updateVocabularyDisplay() {
            if (!vocabularyManager) return;
            
            const vocabularyBook = vocabularyManager.getVocabularyBook();
            const displayDiv = document.getElementById('vocabulary-display');
            const countSpan = document.getElementById('vocab-count');
            
            countSpan.textContent = vocabularyBook.length;
            
            if (vocabularyBook.length === 0) {
                displayDiv.innerHTML = '<p>æš‚æ— ç”Ÿè¯</p>';
                document.getElementById('exportBtn').disabled = true;
            } else {
                let html = '';
                vocabularyBook.forEach((word, index) => {
                    html += `
                        <div class="vocab-item">
                            <div>
                                <span class="word">${word.word}</span>
                                <span class="meaning"> - ${word.meaning}</span>
                            </div>
                            <div class="stats">
                                é”™è¯¯:${word.count} æ”¾å¼ƒ:${word.giveUpCount || 0} ç­‰çº§:${word.level}
                            </div>
                        </div>
                    `;
                });
                displayDiv.innerHTML = html;
                document.getElementById('exportBtn').disabled = false;
            }
        }
        
        async function loadVocabularyManager() {
            updateStatus('æ­£åœ¨åŠ è½½å•è¯åº“ç®¡ç†å™¨...', 'info');
            
            try {
                vocabularyManager = new VocabularyManager();
                
                // ç­‰å¾…åŠ è½½å®Œæˆ
                let waitCount = 0;
                while (!vocabularyManager.isLoaded && waitCount < 50) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                    waitCount++;
                }
                
                if (vocabularyManager.isLoaded) {
                    updateStatus('âœ… å•è¯åº“ç®¡ç†å™¨åŠ è½½æˆåŠŸï¼', 'success');
                    updateVocabularyDisplay();
                } else {
                    updateStatus('âŒ å•è¯åº“ç®¡ç†å™¨åŠ è½½å¤±è´¥æˆ–è¶…æ—¶', 'error');
                }
            } catch (error) {
                updateStatus(`âŒ åŠ è½½å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        function addTestWords() {
            if (!vocabularyManager) {
                updateStatus('âŒ è¯·å…ˆåŠ è½½å•è¯åº“ç®¡ç†å™¨', 'error');
                return;
            }
            
            // æ·»åŠ ä¸€äº›æµ‹è¯•ç”Ÿè¯
            const testWords = [
                { word: 'problem', meaning: 'é—®é¢˜', count: 3, giveUpCount: 1, failCount: 0, level: 1 },
                { word: 'father', meaning: 'çˆ¶äº²', count: 2, giveUpCount: 0, failCount: 1, level: 1 },
                { word: 'number', meaning: 'æ•°å­—', count: 4, giveUpCount: 2, failCount: 0, level: 2 },
                { word: 'sleep', meaning: 'ç¡è§‰', count: 1, giveUpCount: 0, failCount: 0, level: 1 },
                { word: 'sister', meaning: 'å§å¦¹', count: 2, giveUpCount: 1, failCount: 1, level: 2 }
            ];
            
            testWords.forEach(word => {
                vocabularyManager.addToVocabulary(word);
            });
            
            updateStatus(`âœ… å·²æ·»åŠ  ${testWords.length} ä¸ªæµ‹è¯•ç”Ÿè¯`, 'success');
            updateVocabularyDisplay();
        }
        
        function clearVocabulary() {
            if (!vocabularyManager) {
                updateStatus('âŒ è¯·å…ˆåŠ è½½å•è¯åº“ç®¡ç†å™¨', 'error');
                return;
            }
            
            vocabularyManager.clearCurrentLevelVocabulary();
            updateStatus('âœ… ç”Ÿè¯æœ¬å·²æ¸…ç©º', 'success');
            updateVocabularyDisplay();
        }
        
        function exportVocabulary() {
            if (!vocabularyManager) {
                updateStatus('âŒ è¯·å…ˆåŠ è½½å•è¯åº“ç®¡ç†å™¨', 'error');
                return;
            }
            
            const vocabularyBook = vocabularyManager.getVocabularyBook();
            if (vocabularyBook.length === 0) {
                updateStatus('âŒ ç”Ÿè¯æœ¬ä¸ºç©ºï¼Œæ— æ³•å¯¼å‡ºï¼', 'error');
                return;
            }
            
            // åˆ›å»ºæ–‡æœ¬æ ¼å¼çš„æ•°æ®
            let textContent = "=== æˆ‘çš„ç”Ÿè¯æœ¬ ===\\n";
            textContent += `å¯¼å‡ºæ—¶é—´: ${new Date().toLocaleString()}\\n`;
            textContent += `æ€»è®¡: ${vocabularyBook.length} ä¸ªç”Ÿè¯\\n\\n`;
            
            vocabularyBook.forEach((word, index) => {
                textContent += `${index + 1}. ${word.word}\\n`;
                textContent += `   ä¸­æ–‡æ„æ€: ${word.meaning}\\n`;
                textContent += `   é”™è¯¯æ¬¡æ•°: ${word.count}\\n`;
                textContent += `   æ”¾å¼ƒæ¬¡æ•°: ${word.giveUpCount || 0}\\n`;
                textContent += `   å¤±è´¥æ¬¡æ•°: ${word.failCount || 0}\\n`;
                textContent += `   éš¾åº¦ç­‰çº§: ${word.level}\\n`;
                textContent += "\\n";
            });
            
            textContent += "=== å­¦ä¹ å»ºè®® ===\\n";
            textContent += "1. é‡ç‚¹å¤ä¹ é”™è¯¯æ¬¡æ•°è¾ƒå¤šçš„å•è¯\\n";
            textContent += "2. å»ºè®®æ¯å¤©å¤ä¹ 5-10ä¸ªç”Ÿè¯\\n";
            textContent += "3. å¯ä»¥åˆ¶ä½œå•è¯å¡ç‰‡åŠ å¼ºè®°å¿†\\n";
            
            // æ˜¾ç¤ºé¢„è§ˆ
            const previewDiv = document.getElementById('export-preview');
            previewDiv.innerHTML = `<pre style="background: #f8f9fa; padding: 15px; border-radius: 5px; font-size: 0.9em; max-height: 400px; overflow-y: auto;">${textContent}</pre>`;
            
            // åˆ›å»ºä¸‹è½½é“¾æ¥
            const blob = new Blob([textContent], { type: 'text/plain;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `æˆ‘çš„ç”Ÿè¯æœ¬_${new Date().toISOString().split('T')[0]}.txt`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            updateStatus(`âœ… æˆåŠŸå¯¼å‡º ${vocabularyBook.length} ä¸ªç”Ÿè¯åˆ°æ–‡æœ¬æ–‡ä»¶ï¼`, 'success');
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨åŠ è½½å•è¯åº“
        window.addEventListener('load', () => {
            updateStatus('é¡µé¢å·²åŠ è½½ï¼Œç‚¹å‡»"åŠ è½½å•è¯åº“"å¼€å§‹æµ‹è¯•', 'info');
        });
    </script>
</body>
</html>
